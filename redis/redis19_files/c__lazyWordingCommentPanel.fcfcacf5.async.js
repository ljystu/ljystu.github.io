/*! For license information please see c__lazyWordingCommentPanel.fcfcacf5.async.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[141,108],{1349:function(t,e,r){"use strict";r.d(e,"b",(function(){return a})),r.d(e,"a",(function(){return u}));var n=r(622),o=r.n(n),i=(r(29),r(125));function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.search;if(e){var r=o.a.parse(e);return r[t]||""}return""}var c=window.self!==window.top;function u(){var t=a("mode"),e=i.a.get("topicsPageMode");return"clean"===t?(i.a.set("topicsPageMode","clean"),"clean"):"normal"===t?(i.a.remove("topicsPageMode"),"normal"):e&&"clean"===e&&c?"clean":"normal"}},2272:function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));var n=r(191),o={doc:n.OFFICIAL_TEMPLATE_CHANNEL.TEMPLATE_GUIDE_4_DOC_CREATION,board:n.OFFICIAL_TEMPLATE_CHANNEL.TEMPLATE_GUIDE_4_BOARD_CREATION,table:n.OFFICIAL_TEMPLATE_CHANNEL.TEMPLATE_GUIDE_4_TABLE_CREATION,sheet:n.OFFICIAL_TEMPLATE_CHANNEL.TEMPLATE_GUIDE_4_SHEET_CREATION,repoHomePage:n.OFFICIAL_TEMPLATE_CHANNEL.TEMPLATE_GUIDE_4_REPO_HOME_PAGE,teamHomePage:n.OFFICIAL_TEMPLATE_CHANNEL.TEMPLATE_GUIDE_4_TEAM_HOME_PAGE,personalHomePage:n.OFFICIAL_TEMPLATE_CHANNEL.TEMPLATE_GUIDE_4_PERSONAL_HOME_PAGE}},2749:function(t,e,r){"use strict";var n,o=r(0),i=r.n(o),a=r(106),c=r.n(a),u=r(231),l=r.n(u),f=r(84),s=r.n(f),p=r(1574),y=r.n(p),d=r(2778),m=r(873),h=r(98),v=r(2775),b=r.n(v),g=r(2776),w=r.n(g),O=r(1395),_=r.n(O),j=r(2777),E=r(433),S=r(95),P=r(125),x=r(33),C=r(2907);function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function k(t){return function(t){if(Array.isArray(t))return T(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return T(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function R(){R=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),c=new S(o||[]);return n(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var s={};function p(){}function y(){}function d(){}var m={};u(m,i,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(P([])));v&&v!==e&&r.call(v,i)&&(m=v);var b=d.prototype=p.prototype=Object.create(m);function g(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var u=f(t[n],t,i);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==L(s)&&r.call(s,"__await")?e.resolve(s.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(s).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function O(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return x()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=_(a,r);if(c){if(c===s)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=f(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function _(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),s;var o=f(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,s;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function P(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:x}}function x(){return{value:void 0,done:!0}}return y.prototype=d,n(b,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:y,configurable:!0}),y.displayName=u(d,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(w.prototype),u(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),u(b,c,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:P(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},t}function A(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function N(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){A(i,n,o,a,c,"next",t)}function c(t){A(i,n,o,a,c,"throw",t)}a(void 0)}))}}function I(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function G(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,F(n.key),n)}}function D(t,e,r){return(e=F(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function F(t){var e=function(t,e){if("object"!==L(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===L(e)?e:String(e)}var M=c()("biz:lakex_mini_editor_base"),U=(null===(n=window.appData)||void 0===n?void 0:n.me)||{},V=function(){function t(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};I(this,t),D(this,"getDefaultSuggestions",(function(){return e.options.getDefaultSuggestions?e.options.getDefaultSuggestions():[]})),D(this,"setEngine",(function(t){e._engine=t})),D(this,"getEngine",(function(){return e._engine})),D(this,"setValue",(function(t){var r=t;t?t.startsWith("<")?(r={type:"lake",value:t},e._engine.setDocument(r)):"string"==typeof t&&(r={type:"json",value:JSON.parse(t)},e._engine.setDocument(r)):e._engine.setDocument()})),D(this,"getValue",(function(){return e._engine?e._engine.getPureContent():e.getDefaultValue()})),D(this,"isEmpty",(function(){return!e._engine||e._engine.isEmpty()})),D(this,"getSafetyValue",N(R().mark((function t(){return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.contentReady();case 2:return t.abrupt("return",e.getValue());case 3:case"end":return t.stop()}}),t)})))),D(this,"getHtml",(function(){return e._engine?e._engine.getPureHtml():null})),D(this,"focus",(function(t){if(!e._engine)return null;e._engine.focus(t)})),D(this,"contentReady",N(R().mark((function t(){var r,n;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e._engine){t.next=2;break}return t.abrupt("return",null);case 2:return r=0,n=function t(n,o){e._engine.canGetDocument()?n():r>10?o():(r++,setTimeout((function(){t(n,o)}),1e3))},t.abrupt("return",new Promise(n));case 5:case"end":return t.stop()}}),t)})))),D(this,"saveAll",(function(){if(!e.options.disableCache){var t={format:s.a.FORMAT.LAKE,value:e.getValue(),html:e.getHtml()};e.saveToCache(t)}})),this.options=r,this.from=r.from||"reply",this.targetType=r.targetType,this.belong=r.belong,this.belongType=r.belongType,this.group=r.group,this.target=r.target,this.attachType=r.attachType,this.isEditMode=!!r.target,this.type=this.getType(),this.ctoken=Object(E.a)(window);var n=this.getCacheKey();this.cacheKeys={title:"".concat(n,"/title"),content:"".concat(n,"/content")},this.editorCache=new C.a(this.cacheKeys.content),this.uuid=this.getUuid(),this._engine=null,this.initialDocument=null,this.init()}var e,r,n;return e=t,r=[{key:"init",value:function(){this.initialDocument=this.getInitialDocument(),M("init use: ",this.initialDocument)}},{key:"buildOptions",value:function(t){var e={supportTranslate:w()(),supportImgOCR:_()(),hideEmbedButton:b()(),hideVipIcon:Object(j.a)(),board:{boardWebProxyParams:{webProxy:x.a,userId:null==U?void 0:U.id,spm:h,appData:window.appData}},image:{uploadFileURL:this.getImageUploadUrl(),accept:Object(m.getImageAcceptArr)()},file:{uploadFileURL:this.getFileUploadUrl(),accept:Object(m.getFileAcceptArr)(),localdocAccept:Object(m.getLocalDocAcceptArr)(),embedButtonStatus:Object(m.getIsDiabledPreviewAndEmbed)()},transfer:{transferFilesURL:this.getTransferUrl()},localdoc:{uploadFileURL:this.getFileUploadUrl(),accept:Object(m.getLocalDocAcceptArr)()},mention:{mentionURL:S.a.patchGroupIdToUrl(this.getMentionActionUrl()),defaultList:this.getDefaultSuggestions()},lockedtext:{action:this.getCryptoUrl()},placeholder:(null==t?void 0:t.placeholder)||this.getPlaceholder(),link:{autoCompleteLink:null==t?void 0:t.autoCompleteLink},video:{uploadAction:this.getMediaUploadUrl("video"),queryAction:"/api/video",accept:Object(m.getVideoAcceptArr)()},audio:{uploadFileURL:this.getMediaUploadUrl("audio"),queryURL:"/api/video",accept:Object(m.getAudioAcceptArr)()},vote:{allowVote:!0,queryDetailUrl:"api/votes",queryCheckUrl:"api/votes/mine",voteUrl:"api/votes"},yuque:{disableEmbedView:this.getDisableYuqueCardEmbedView()},materialLibrary:{component:i.a.createElement(d.a,{storage:P.a,webProxy:x.a})},fullscreen:{enable:this.getEnableFullEditor()}},r=[],n=this.getBlockedCards();return n&&n.length>1&&(r=Array.from(new Set([].concat(k(r),k(n))))),e.disabledPlugins=r,e}},{key:"getProps",value:function(){return{format:this.getFormat(),defaultValue:this.getDefaultValue(),autoFocus:this.getAutoFocus(),isMiniSize:this.isMiniSize()}}},{key:"getType",value:function(){return this.options.type||"unknown"}},{key:"getAutoFocus",value:function(){var t=this.options.autoFocus;return null!=t?t:!!this.options.useMiniGuide}},{key:"isMiniSize",value:function(){return!1}},{key:"getEnableFullEditor",value:function(){return!0}},{key:"getBlockedCards",value:function(){return["video","checkIn","vote","audio","premium"]}},{key:"getUuid",value:function(){var t=this.cacheKeys.uuid,e=P.a.get(t);return e||(e=l()(32)+l()(32),P.a.set(t,e)),e}},{key:"getDefaultFormat",value:function(){return s.a.FORMAT.LAKE}},{key:"getFormat",value:function(){var t=this.options.format;return t||this.initialDocument.format}},{key:"getPlaceholder",value:function(){return this.options.placeholder}},{key:"getInitialDocument",value:function(){if(this.initialDocument)return this.initialDocument;var t=this.loadFromCache();if(M("cached document:",t),this.isEditMode){var e=this.getContentObject();return M("adapted content: ",e),t&&(M("merge with cached content",t),e.format=t.format||e.format,e.title=t.title||e.title,e.value=t.value||e.value),e}if(t)return t.format=t.format||this.getDefaultFormat(),t;var r=this.loadFromUrl();return r||{format:this.getDefaultFormat(),title:null,value:null}}},{key:"getContentObject",value:function(t){return{format:(t=t||this.target||{}).format||this.getDefaultFormat(),title:t.title||t.name||"",value:t.value||t.body_asl||t.content}}},{key:"getDefaultValue",value:function(){var t=this.options.defaultValue;return t||this.initialDocument.value}},{key:"getFullUrl",value:function(t){return this.isEditMode&&!this.options.useBelongAttach?"".concat(t,"&attachable_type=").concat(this.attachType,"&attachable_id=").concat(this.target.id,"&from=").concat(this.from):this.belong?"".concat(t,"&attachable_type=").concat(this.attachType,"&attachable_id=").concat(this.belong.id,"&from=").concat(this.from):null}},{key:"getTransferUrl",value:function(){var t="/api/upload/copy?type=attachment",e=this.getFullUrl(t);return e||(e="".concat(t,"&attachable_uuid=").concat(this.uuid,"&from=").concat(this.from)),e}},{key:"getFileUploadUrl",value:function(){var t="/api/upload/attach?ctoken=".concat(this.ctoken,"&type=attachment");return this.getFullUrl(t)}},{key:"getMediaUploadUrl",value:function(t){var e="/api/video?ctoken=".concat(this.ctoken,"&format=").concat(t);return this.getFullUrl(e)}},{key:"getImageUploadUrl",value:function(){var t=this.getFileUploadUrl();return t?t.replace("&type=attachment","&type=image"):null}},{key:"getMentionActionUrl",value:function(){var t="";return this.isEditMode&&!this.options.useBelongAttach?t="/api/users/complete?target_type=".concat(this.attachType,"&target_id=").concat(this.target.id):this.belong&&(t="/api/users/complete?target_type=".concat(this.attachType,"&target_id=").concat(this.belong.id)),t}},{key:"getCryptoUrl",value:function(){return"/api/services/crypto"}},{key:"getDisableYuqueCardEmbedView",value:function(){return this.options.disableYuqueCardEmbedView}},{key:"saveToCache",value:function(t){M("save to cache:",t),t.format&&(t.title&&P.a.set(this.cacheKeys.title,t.title),this.needCacheContent(t)?this.editorCache.put(t.value,t.format):M("value is empty or the same as origin, ignore cache"))}},{key:"needCacheContent",value:function(t){if(!t.value)return!1;if(y.a.isBlank(t))return this.editorCache.clear(),!1;if(!this.target)return!0;var e=this.getContentObject();return!y.a.isContentSame(t.format,e.value,t.value)}},{key:"reset",value:function(){M("reset editor"),this.clearCache(),this._engine&&this._engine.setDocument()}},{key:"isContentChanged",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!t){var e=this.loadFromCache();e&&(t=e.value)}if(!this.target)return!0;var r="<cursor />",n=this.target.body_asl;return n.trim().replace(r,"")!==t.trim().replace(r,"")}},{key:"clearCache",value:function(){var t=this;M("clear cache"),Object.keys(this.cacheKeys).forEach((function(e){P.a.remove(t.cacheKeys[e])}))}},{key:"getCacheKey",value:function(){return this.isEditMode&&this.target&&this.belong?"autosave/".concat(this.type,"/").concat(this.belong.id,"/").concat(this.target.id,"/edit"):this.belong?"autosave/".concat(this.type,"/").concat(this.belong.id,"/new"):"autosave/".concat(this.type)}},{key:"loadFromUrl",value:function(){}},{key:"loadFromCache",value:function(){var t=!1,e={format:null,title:null,value:null},r=this.editorCache.retrieve();if(r&&(t=!0,e.format=r.format,e.value=r.value),this.cacheKeys.title){var n=P.a.get(this.cacheKeys.title);n&&(t=!0,e.title=n)}return t?e:null}}],n=[{key:"getEmptyDocument",value:function(){return{format:s.a.FORMAT.LAKE,value:null}}}],r&&G(e.prototype,r),n&&G(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.a=V},2759:function(t,e,r){"use strict";var n=r(25);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(i=n.key,a=void 0,a=function(t,e){if("object"!==o(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(i,"string"),"symbol"===o(a)?a:String(a)),n)}var i,a}function c(){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=u(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},c.apply(this,arguments)}function u(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=p(t)););return t}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=p(t);if(e){var o=p(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return s(this,r)}}function s(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function p(t){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},p(t)}var y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}(s,t);var e,r,o,u=f(s);function s(){return i(this,s),u.apply(this,arguments)}return e=s,(r=[{key:"buildOptions",value:function(t){var e=c(p(s.prototype),"buildOptions",this).call(this,t);return e.disabledPlugins.push("mobile"),n.ua.mobile&&e.disabledPlugins.push("placeholder","slash"),e}},{key:"getBlockedCards",value:function(){return["video","audio","premium","checkIn"]}}])&&a(e.prototype,r),o&&a(e,o),Object.defineProperty(e,"prototype",{writable:!1}),s}(r(2749).a);e.a=y},2773:function(t,e,r){"use strict";var n=r(176),o=r.n(n),i=r(51);function a(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var u={adaptAbilities:function(t){var e=t.me,r=t.comment,n=t.target_type,o=t.target,i={edit:!1,delete:!1};return e&&e.id===r.user_id?(i.edit=!0,i.delete=!0):"Doc"===n&&(i.delete=o.abilities&&o.abilities.destroy_comment),i},getPostActions:function(t,e){var r=[];return r.push({cmd:"copy_link",title:__("复制链接")}),r.push({cmd:"reply",title:__("评论")}),t.edit&&r.push({cmd:"edit",title:__("编辑")}),t.delete&&r.push({cmd:"delete",title:__("删除"),confirm:!0}),e&&r.push({cmd:"content_report",title:__("举报")}),r},includesHashAnchoredComment:function(t,e){if(!e||!e.startsWith("#comment-"))return!1;var r=parseInt(e.substring("#comment-".length),10);return!!t.find((function(t){return t.id===r}))},getParticipants:function(t,e,r){var n=r.groupMembers,c=r.targetType,u=[];return"Topic"===c?u.push(t.user):"Doc"!==c&&"Resource"!==c||(t.contributors=t.contributors||[],u=a(t.contributors)),e&&e.length>0&&e.forEach((function(t){var e=u.find((function(e){return e&&t.user&&e.id===t.user.id}));t.user&&!e&&u.push(t.user)})),n&&n.length>0&&n.forEach((function(t){u.push(t.user)})),u=o()(u,"login"),window.appData.isYuque&&(u=u&&u.filter((function(t){return t.status!==i.STATUS.terminated}))),u},getAnchorId:function(t,e){return"".concat("Topic"===e?"reply-":"comment-").concat(t)},TARGET_TYPES:["Doc","DocVersion","Resource","Topic","Artboard","Note"]};e.a=u},2803:function(t,e,r){"use strict";var n=r(33),o={epv:function(t){var e=t.type,r=t.id;n.a.logs.activity({type:e,action:"epv",id:r})}};e.a=o},2812:function(t,e,r){"use strict";r.d(e,"a",(function(){return c}));var n=r(0),o=r.n(n),i=r(435),a=r(164);function c(t){var e=window.appData||{},r=e.isYuque,n=e.organization,c=e.group,u=void 0===c?{}:c,l=e.me,f=void 0===l?{}:l,s=null==n?void 0:n.id;if(!r||Object(a.isPaid)())throw new Error("should not be show this");var p=!(i.a.isAlipayApp()||i.a.isAndroid()||i.a.isIOS()||i.a.isDingtalk()||i.a.getMobileAppVersion());if(s){var y,d=null==n||null===(y=n.abilities)||void 0===y?void 0:y.destroy;if(d&&p){var m="/r/organizations/dashboard/cashier?action=renew";return void t(o.a.createElement("span",{},[__("升级为付费版空间后可嵌入文件"),o.a.createElement("a",{style:{marginLeft:5},rel:"noreferrer",href:m,target:"_blank",onClick:function(t){window.openExternalLink&&(window.openExternalLink(m,!0),t.preventDefault())}},[__("立即升级")])]))}return t(d?__("升级为付费版空间后可嵌入文件"):__("联系管理员升级为付费版空间后可嵌入文件"))}if(window.appData.group&&u.id!==f.id)return t(__("联系知识库所有者开通会员后可嵌入文件"));if(p){var h="pay_source=file_embed";window.openExternalLink&&(h+="&pay_referer=desktop_app");var v="/settings/member?".concat(h,"#renew");return t(o.a.createElement("span",{},[__("开通会员后可嵌入文件"),o.a.createElement("a",{style:{marginLeft:5},rel:"noreferrer",href:v,target:"_blank",onClick:function(t){window.openExternalLink&&(window.openExternalLink(v,!0),t.preventDefault())}},[__("开通会员")])]))}return t(__("开通会员后可嵌入文件"))}},2817:function(t,e,r){"use strict";r.d(e,"c",(function(){return m})),r.d(e,"a",(function(){return E})),r.d(e,"l",(function(){return I})),r.d(e,"j",(function(){return it})),r.d(e,"h",(function(){return dt})),r.d(e,"i",(function(){return jt})),r.d(e,"k",(function(){return Rt})),r.d(e,"f",(function(){return Mt})),r.d(e,"d",(function(){return Ht})),r.d(e,"e",(function(){return Xt})),r.d(e,"g",(function(){return ue})),r.d(e,"b",(function(){return ve}));var n=r(84),o=r.n(n),i=r(1343),a=r(2749);function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==c(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===c(i)?i:String(i)),n)}var o,i}function f(t,e){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},f(t,e)}function s(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=y(t);if(e){var o=y(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function p(t,e){if(e&&("object"===c(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},y(t)}var d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&f(t,e)}(c,t);var e,r,n,a=s(c);function c(){return u(this,c),a.apply(this,arguments)}return e=c,n=[{key:"getEmptyDocument",value:function(){return{format:o.a.FORMAT.LAKE,value:null}}}],(r=[{key:"getType",value:function(){var t=this.options.targetType;return t?"".concat(t,"_comment").toLowerCase():"comment"}},{key:"getCacheKey",value:function(){var t=this.options.replyId;return this.isEditMode&&this.target&&this.belong?"autosave/".concat(this.type,"/").concat(this.belong.id,"/").concat(this.target.id,"/edit"):this.belong?"autosave/".concat(this.type,"/").concat(this.belong.id,"/").concat(t,"/new"):"autosave/".concat(this.type)}},{key:"isMiniSize",value:function(){return this.options.useMiniGuide||this.options.isMiniSize||window.h5}},{key:"getDefaultFormat",value:function(){return i.a.getDefaultDocumentFormat(o.a.TYPE.TOPIC)}},{key:"getEnableFullEditor",value:function(){return"Artboard"!==this.targetType}}])&&l(e.prototype,r),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),c}(a.a),m=d;function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==h(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===h(i)?i:String(i)),n)}var o,i}function g(t,e){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},g(t,e)}function w(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=_(t);if(e){var o=_(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return O(this,r)}}function O(t,e){if(e&&("object"===h(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _(t){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_(t)}var j=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&g(t,e)}(i,t);var e,r,n,o=w(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return v(this,i),t.attachType="Resource",t.useBelongAttach=!0,t.from="reply",o.call(this,t)}return e=i,(r=[{key:"getType",value:function(){return"area_comment"}},{key:"getAutoFocus",value:function(){return!0}},{key:"isMiniSize",value:function(){return!0}}])&&b(e.prototype,r),n&&b(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(m),E=j;function S(t){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S(t)}function P(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function x(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==S(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===S(i)?i:String(i)),n)}var o,i}function C(){return C="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=L(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},C.apply(this,arguments)}function L(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=A(t)););return t}function k(t,e){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},k(t,e)}function T(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=A(t);if(e){var o=A(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return R(this,r)}}function R(t,e){if(e&&("object"===S(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function A(t){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},A(t)}var N=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&k(t,e)}(i,t);var e,r,n,o=T(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return P(this,i),t.attachType="Doc",t.useBelongAttach=!0,t.from="reply",o.call(this,t)}return e=i,(r=[{key:"buildOptions",value:function(t){var e,r=C(A(i.prototype),"buildOptions",this).call(this,t);return r.image.showMiniToolbarWhen="never",null===(e=r.disabledPlugins)||void 0===e||e.push("slash"),r}},{key:"getType",value:function(){return"word_comment"}},{key:"getAutoFocus",value:function(){return!1}},{key:"isMiniSize",value:function(){return!0}},{key:"getEnableFullEditor",value:function(){return!1}}])&&x(e.prototype,r),n&&x(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(m),I=N,G=r(1349),D=r(125),F=r(2759);function M(t){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M(t)}function U(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==M(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==M(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===M(i)?i:String(i)),n)}var o,i}function V(t,e){return V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},V(t,e)}function B(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=q(t);if(e){var o=q(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Y(this,r)}}function Y(t,e){if(e&&("object"===M(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function q(t){return q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},q(t)}F.a;var z=r(29),H=r.n(z);function K(t){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K(t)}function W(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function $(t,e,r){return(e=Q(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Z(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function J(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Q(n.key),n)}}function Q(t){var e=function(t,e){if("object"!==K(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==K(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===K(e)?e:String(e)}function X(t,e){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},X(t,e)}function tt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=rt(t);if(e){var o=rt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return et(this,r)}}function et(t,e){if(e&&("object"===K(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function rt(t){return rt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},rt(t)}var nt={daily:{title:"#prefix# #day# 日报汇总",content:'<!doctype lake><meta name="doc-version" content="1" /><p>建议 TL 每天组织日会，将一天的重点事项安排于此</p><p>每位同学下班前，在此提交日报</p><p><br /></p><p>日报不要记流水账，尽量在 200 字以内</p><p>重点项目或工作要及时总结和提报，尤其风险点要及时提报</p><p>可以写写思考和感想</p><p><br /></p><p>写完自己的日报，也看看大家的</p><p>每一位同学的努力，都值得认真阅读与交流</p><p><br /></p><p><span style="color: #FA541C;"><span>注意不要提及保密项目和敏感数据</span></span></p>'},weekly:{title:"#prefix# #day# 周报汇总",content:'<!doctype lake><meta name="doc-version" content="1" /><p>将一周的工作总结回复于此</p><p><br /></p><p>不要记流水账，尽量在 800 字以内</p><p>重点项目或工作要及时总结和提报，尤其风险点要及时提报</p><p>可以写写思考和感想</p><p><br /></p><p>写完自己的周报，也看看大家的</p><p>每一位同学的努力，都值得认真阅读与交流</p><p><br /></p><p><span style="color: #FA541C;"><span>注意不要提及保密项目和敏感数据</span></span></p>'},vote:{title:"一起来投票吧",content:'<!doctype lake><meta name="doc-version" content="1" /><card type="block" name="vote" value="data:%7B%22margin%22%3Atrue%2C%22id%22%3A%22jTHWG%22%2C%22type%22%3A%22single%22%7D"></card><p><br /><cursor /></p>'},default:{title:"",content:"<!doctype lake><p></p>"}},ot=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&X(t,e)}(i,t);var e,r,n,o=tt(i);function i(){return Z(this,i),o.apply(this,arguments)}return e=i,n=[{key:"getTemplate",value:function(t,e){var r=nt[t];if(!r)return{title:null,content:null};var n=H()(new Date).format("YYYY-MM-DD"),o=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?W(Object(r),!0).forEach((function(e){$(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):W(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},r);return o.title=o.title.replace("#prefix#",e),o.title=o.title.replace("#day#",n),o}}],(r=[{key:"getType",value:function(){return"thread"}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete?target_type=Group&target_id=".concat(this.group.id)}},{key:"getFileUploadUrl",value:function(){var t="/api/upload/attach?ctoken=".concat(this.ctoken,"&type=attachment");return this.isEditMode?"".concat(t,"&attachable_type=").concat(this.attachType,"&attachable_id=").concat(this.target.id,"&from=").concat(this.from):this.belong?"".concat(t,"&attachable_type=").concat(this.belongType||"Book","&attachable_id=").concat(this.belong.id,"&from=").concat(this.from):this.group?"".concat(t,"&attachable_type=User&attachable_id=").concat(this.group.id,"&from=").concat(this.from):null}},{key:"getFileCopyUrl",value:function(){var t="/api/upload/copy?type=attachment";return this.isEditMode?"".concat(t,"&attachable_type=").concat(this.attachType,"&attachable_id=").concat(this.target.id,"&from=").concat(this.from):"".concat(t,"&attachable_uuid=").concat(this.uuid,"&from=").concat(this.from)}}])&&J(e.prototype,r),n&&J(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(F.a),it=ot;function at(t){return at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},at(t)}function ct(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ut(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==at(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==at(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===at(i)?i:String(i)),n)}var o,i}function lt(t,e){return lt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},lt(t,e)}function ft(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=pt(t);if(e){var o=pt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return st(this,r)}}function st(t,e){if(e&&("object"===at(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function pt(t){return pt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},pt(t)}var yt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lt(t,e)}(i,t);var e,r,n,o=ft(i);function i(){return ct(this,i),o.apply(this,arguments)}return e=i,(r=[{key:"getType",value:function(){return"thread_board"}},{key:"getAutoFocus",value:function(){return!0}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete?target_type=Group&target_id=".concat(this.group.id)}},{key:"getFileUploadUrl",value:function(){var t="/api/upload/attach?ctoken=".concat(this.ctoken,"&type=attachment");return this.isEditMode&&!this.options.useBelongAttach?"".concat(t,"&attachable_type=").concat(this.attachType,"&attachable_id=").concat(this.target.id,"&from=").concat(this.from):this.belong?"".concat(t,"&attachable_type=").concat(this.belongType,"&attachable_id=").concat(this.belong.id,"&from=").concat(this.from):null}}])&&ut(e.prototype,r),n&&ut(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(a.a),dt=yt;function mt(t){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mt(t)}function ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function vt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==mt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==mt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===mt(i)?i:String(i)),n)}var o,i}function bt(t,e){return bt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},bt(t,e)}function gt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ot(t);if(e){var o=Ot(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return wt(this,r)}}function wt(t,e){if(e&&("object"===mt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ot(t){return Ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ot(t)}var _t=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bt(t,e)}(i,t);var e,r,n,o=gt(i);function i(){return ht(this,i),o.apply(this,arguments)}return e=i,(r=[{key:"getType",value:function(){return"thread_comment"}}])&&vt(e.prototype,r),n&&vt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(m),jt=_t;function Et(t){return Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Et(t)}function St(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==Et(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Et(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===Et(i)?i:String(i)),n)}var o,i}function Pt(){return Pt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=xt(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},Pt.apply(this,arguments)}function xt(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Tt(t)););return t}function Ct(t,e){return Ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ct(t,e)}function Lt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Tt(t);if(e){var o=Tt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return kt(this,r)}}function kt(t,e){if(e&&("object"===Et(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Tt(t){return Tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Tt(t)}var Rt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ct(t,e)}(i,t);var e,r,n,o=Lt(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.attachType="User",t.useBelongAttach=!0,o.call(this,t)}return e=i,(r=[{key:"buildOptions",value:function(t){var e=Pt(Tt(i.prototype),"buildOptions",this).call(this,t);return e.typography={mustTypography:"classic",typography:"classic",paragraphSpacing:"relax"},e}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete"}},{key:"isMiniSize",value:function(){return this.options.small}},{key:"getAutoFocus",value:function(){return!0}}])&&St(e.prototype,r),n&&St(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(a.a);function At(t){return At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},At(t)}function Nt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==At(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==At(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===At(i)?i:String(i)),n)}var o,i}function It(t,e){return It=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},It(t,e)}function Gt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ft(t);if(e){var o=Ft(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Dt(this,r)}}function Dt(t,e){if(e&&("object"===At(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ft(t){return Ft=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ft(t)}var Mt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&It(t,e)}(i,t);var e,r,n,o=Gt(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.from="group_custom",t.attachType="User",t.useBelongAttach=!0,o.call(this,t)}return e=i,(r=[{key:"getType",value:function(){return"group_custom"}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete?target_type=Group&target_id=".concat(this.group.id)}},{key:"isMiniSize",value:function(){return this.options.small}},{key:"getAutoFocus",value:function(){return!0}}])&&Nt(e.prototype,r),n&&Nt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(a.a);function Ut(t){return Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ut(t)}function Vt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==Ut(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Ut(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===Ut(i)?i:String(i)),n)}var o,i}function Bt(t,e){return Bt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Bt(t,e)}function Yt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=zt(t);if(e){var o=zt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return qt(this,r)}}function qt(t,e){if(e&&("object"===Ut(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function zt(t){return zt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},zt(t)}var Ht=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Bt(t,e)}(i,t);var e,r,n,o=Yt(i);function i(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var e=t.feedback;return t.attachType="User",t.useBelongAttach=!0,t.from="feedback",t.placeholder={tip:e&&e.abilities.manage?"你将要代表语雀回复用户，请使用官方口吻，慎重填写":"",emptyParagraphTip:""},o.call(this,t)}return e=i,(r=[{key:"getType",value:function(){return"feedback_comment"}},{key:"getCacheKey",value:function(){var t=this.getType();if(this.target)return"autosave/".concat(t,"/").concat(this.target.id,"/edit");var e=this.options.feedback;return e?"autosave/".concat(t,"/").concat(e.id,"/new"):"autosave/".concat(t)}},{key:"getContentObject",value:function(){var t=this.target.content||{source:"",format:"lake"};return{format:t.format,value:t.source||""}}},{key:"isMiniSize",value:function(){return!0}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete"}},{key:"getAutoFocus",value:function(){return!0}}])&&Vt(e.prototype,r),n&&Vt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(F.a);function Kt(t){return Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kt(t)}function Wt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==Kt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Kt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===Kt(i)?i:String(i)),n)}var o,i}function $t(t,e){return $t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},$t(t,e)}function Zt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Qt(t);if(e){var o=Qt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Jt(this,r)}}function Jt(t,e){if(e&&("object"===Kt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Qt(t){return Qt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Qt(t)}var Xt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$t(t,e)}(i,t);var e,r,n,o=Zt(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.attachType="User",t.useBelongAttach=!0,t.placeholder={tip:"",emptyParagraphTip:""},t.from="feedback",o.call(this,t)}return e=i,(r=[{key:"getType",value:function(){return"feedback_remark"}},{key:"getContentObject",value:function(){return{format:"lake",value:this.target.remark||""}}},{key:"getCacheKey",value:function(){return this.target?"autosave/".concat(this.type,"/").concat(this.target.id):"autosave/".concat(this.type)}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete"}},{key:"getAutoFocus",value:function(){return!0}},{key:"isMiniSize",value:function(){return!0}}])&&Wt(e.prototype,r),n&&Wt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(F.a);function te(t){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},te(t)}function ee(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==te(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===te(i)?i:String(i)),n)}var o,i}function re(){return re="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=ne(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},re.apply(this,arguments)}function ne(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ce(t)););return t}function oe(t,e){return oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},oe(t,e)}function ie(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=ce(t);if(e){var o=ce(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return ae(this,r)}}function ae(t,e){if(e&&("object"===te(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ce(t){return ce=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ce(t)}var ue=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&oe(t,e)}(i,t);var e,r,n,o=ie(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.target&&(t.attachType="Doclet"),o.call(this,t)}return e=i,(r=[{key:"getCards",value:function(){return this.options.target?re(ce(i.prototype),"getCards",this).call(this):["label"]}},{key:"getFullCards",value:function(){return this.options.target?re(ce(i.prototype),"getFullCards",this).call(this):["label"]}},{key:"getAutoFocus",value:function(){return!0}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete"}},{key:"isMiniSize",value:function(){return!1}}])&&ee(e.prototype,r),n&&ee(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(a.a);function le(t){return le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},le(t)}function fe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==le(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==le(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===le(i)?i:String(i)),n)}var o,i}function se(){return se="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=pe(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},se.apply(this,arguments)}function pe(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=he(t)););return t}function ye(t,e){return ye=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ye(t,e)}function de(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=he(t);if(e){var o=he(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return me(this,r)}}function me(t,e){if(e&&("object"===le(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function he(t){return he=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},he(t)}var ve=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ye(t,e)}(i,t);var e,r,n,o=de(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.attachType="Doclet",o.call(this,t)}return e=i,(r=[{key:"buildOptions",value:function(t){var e=se(he(i.prototype),"buildOptions",this).call(this,t);return e.typography={typography:"classic",paragraphSpacing:"relax"},e}},{key:"isMiniSize",value:function(){return this.options.small}},{key:"getAutoFocus",value:function(){return!0}}])&&fe(e.prototype,r),n&&fe(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(a.a)},2831:function(t,e,r){"use strict";r.r(e);r(63);var n=r(23),o=r(0),i=r.n(o),a=r(2),c=r.n(a),u=r(2803),l=r(1417),f=r(2812),s=r(2922),p=r(771),y=r(345),d=r(98),m=r(1346),h=(r(251),r(116)),v=r(106),b=r.n(v),g=r(324),w=r.n(g),O=r(84),_=r.n(O),j=r(778),E=r(33);function S(t){return[_.a.FORMAT.MARKDOWN,_.a.FORMAT.ASL].includes(t)}var P="EditorBase-module_init_eZbjJ",x="EditorBase-module_editor_zrggr";function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function L(){L=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),c=new S(o||[]);return n(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var s={};function p(){}function y(){}function d(){}var m={};u(m,i,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(P([])));v&&v!==e&&r.call(v,i)&&(m=v);var b=d.prototype=p.prototype=Object.create(m);function g(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var u=f(t[n],t,i);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==C(s)&&r.call(s,"__await")?e.resolve(s.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(s).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function O(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return x()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=_(a,r);if(c){if(c===s)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=f(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function _(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),s;var o=f(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,s;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function P(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:x}}function x(){return{value:void 0,done:!0}}return y.prototype=d,n(b,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:y,configurable:!0}),y.displayName=u(d,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(w.prototype),u(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),u(b,c,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:P(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},t}function k(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function T(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return R(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return R(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var A=b()("editor:lakex_mini");function N(t){var e=t.editor,r=t.onChange,n=t.onSubmit,a=t.onLoad,c=e.getProps(),u=c.format,l=c.autoFocus,f=c.isMiniSize,s=c.defaultValue,p=T(Object(o.useState)(S(u)),2),y=p[0],d=p[1],m=T(Object(o.useState)(s),2),v=m[0],b=m[1],g=T(Object(o.useState)(!1),2),O=g[0],C=g[1],R=Object(o.useMemo)((function(){return i.a.createRef()}),[y]),N=i.a.createRef();Object(o.useEffect)((function(){if(S(u)){if(A("convert: ".concat(u," -> lake")),!s)return d(!1),void b("");E.a.docs.convertContent({from:u,to:_.a.FORMAT.LAKE,content:s}).then((function(t){A("convert done:",t),d(!1),b(t.content),C(!0)})).catch((function(t){A("convert fail:",t.message),d(!1)}))}}),[]),Object(o.useEffect)((function(){var t="⌘+enter, ctrl+enter";return w()(t,(function(t){N.current&&N.current.isFocus&&n&&n(t)})),function(){w.a.unbind(t)}}),[]);var I=function(){var n,o=(n=L().mark((function n(){var o,i,c;return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(R.current){n.next=2;break}return n.abrupt("return");case 2:if(R.current){n.next=4;break}return n.abrupt("return");case 4:o=f?j.createMicroEditor:j.createMinorEditor,i=e.buildOptions(t),c=o(R.current,i),window.__miniEngine=c,N.current=c,e.setEngine(c),e.setValue(v),c.on("fullscreenStatusChange",(function(t){var e=new CustomEvent("neEditorFullscreenStatusChange",{detail:{isFullscreen:t,engine:c,editorNode:c.editorNode}});window.dispatchEvent(e)})),c.on("change",(function(){r&&r(),e.saveAll()})),a&&a(c),l&&c.focus(!1);case 15:case"end":return n.stop()}}),n)})),function(){var t=this,e=arguments;return new Promise((function(r,o){var i=n.apply(t,e);function a(t){k(i,r,o,a,c,"next",t)}function c(t){k(i,r,o,a,c,"throw",t)}a(void 0)}))});return function(){return o.apply(this,arguments)}}();Object(o.useEffect)((function(){I()}),[y,O]);return y?i.a.createElement("div",{id:"larkx-mini-editor",className:P},i.a.createElement(h.a,null)):u===_.a.FORMAT.LAKE||O?i.a.createElement("div",{id:"lark-mini-editor",className:x,ref:R}):i.a.createElement("div",{id:"lark-mini-editor",className:P},i.a.createElement("h4",null,__("内容格式异常，暂无法编辑")),i.a.createElement("pre",null,t.defaultValue))}N.propTypes={editor:c.a.object,onChange:c.a.func,onLoad:c.a.func,onSubmit:c.a.func};var I=N,G="index-module_lakeCreateGuide_VutDm";function D(t){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D(t)}function F(){F=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),c=new S(o||[]);return n(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var s={};function p(){}function y(){}function d(){}var m={};u(m,i,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(P([])));v&&v!==e&&r.call(v,i)&&(m=v);var b=d.prototype=p.prototype=Object.create(m);function g(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var u=f(t[n],t,i);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==D(s)&&r.call(s,"__await")?e.resolve(s.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(s).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function O(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return x()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=_(a,r);if(c){if(c===s)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=f(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function _(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),s;var o=f(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,s;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function P(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:x}}function x(){return{value:void 0,done:!0}}return y.prototype=d,n(b,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:y,configurable:!0}),y.displayName=u(d,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(w.prototype),u(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),u(b,c,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:P(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},t}function M(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function U(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){M(i,n,o,a,c,"next",t)}function c(t){M(i,n,o,a,c,"throw",t)}a(void 0)}))}}function V(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return B(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return B(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Y=!1;function q(t){var e=Object(o.useRef)(),r=V(Object(o.useState)(!1),2),a=r[0],c=r[1],h=Object(o.useRef)(!1),v=function(){var t=e.current.isEmpty();h.current!==t&&(c(t),h.current=t)},b=Object(o.useCallback)(function(){var t=U(F().mark((function t(e){var r;return F().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(p.l)(e.id);case 2:if((r=t.sent).format!==y.FORMAT.LAKETABLE&&!/<card.*name=\"dataTable\"/.test(r.doclet.body_asl)){t.next=5;break}return t.abrupt("return",{content:""});case 5:return Object(d.spmClick)(m.a.TEMPLATE_USAGE,{id:r.id,type:r.type,format:r.format,name:r.name,platform:"pc"}),t.abrupt("return",{content:r.format===y.TYPE_FORMAT_MAP.Doc?r.doclet.body_asl:r.doclet.body});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[]),g=Object(o.useCallback)(function(){var r=U(F().mark((function r(n){var o;return F().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,b(n);case 2:if(null!=(o=r.sent)&&o.content){r.next=5;break}return r.abrupt("return");case 5:e.current.setDocument("lake",o.content),c(!1),h.current=!1,t.onChange();case 9:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}(),[b,t.onChange]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(I,{autoFocus:!0,editor:t.editor,autoCompleteLinks:t.autoCompleteLinks,onChange:function(){t.onChange(),v(),Y||(Y=!0,u.a.epv({type:"MiniEditor"}))},onLoad:function(r){e.current=r,t.onLoad(r),v(),r.on("unSupportFileUpload",(function(t){var e;n.a.warning(Object(l.a)(null==t||null===(e=t.extName)||void 0===e?void 0:e.toLowerCase()))})),r.on("clickEmbedButton",(function(){Object(f.a)(n.a.warning.bind(n.a))}))},onSubmit:t.onSubmit,isMiniSize:t.isMiniSize,placeholder:t.placeholder}),t.needCreateGuide&&a?i.a.createElement("div",{className:G},i.a.createElement(s.default,{doc:t.tplDoc,showRecent:!1,needMore:!1,isFullWidth:!0,visible:!0,includePersonal:!1,onUseTemplate:g})):null)}q.defaultProps={onLoad:function(){},onChange:function(){}},q.propTypes={editor:c.a.object.isRequired,tplDoc:c.a.object,onChange:c.a.func,onSubmit:c.a.func,onLoad:c.a.func,autoCompleteLinks:c.a.bool,isMiniSize:c.a.bool,placeholder:c.a.object,needCreateGuide:c.a.bool};e.default=q},2907:function(t,e,r){"use strict";var n=r(106),o=r.n(n),i=r(125),a=r(1574),c=r.n(a);function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==u(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===u(i)?i:String(i)),n)}var o,i}var f=o()("editor:cache"),s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.key=e}var e,r,n;return e=t,(r=[{key:"retrieve",value:function(){var t={format:null,value:null};f("[retrieve]key: ",this.key);var e=i.a.get(this.key);if(!e)return null;f("[retrieve]find text: ",e);var r=c.a.guessFormat(e);return t.format=r,t.value=e,f("[retrieve]doc: ",t),t}},{key:"put",value:function(t,e){f("[put]content cached: ","".concat(this.key," -> ").concat(t)),i.a.set(this.key,t)}},{key:"clear",value:function(){i.a.remove(this.key)}}])&&l(e.prototype,r),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.a=s},2913:function(t,e,r){"use strict";var n,o=[{id:1,title:__("加油")},{id:2,title:__("开心")},{id:3,title:__("很忙")},{id:4,title:__("想哭")},{id:5,title:__("生气")}],i=(n={},o.forEach((function(t){n[t.id]=t})),n),a=[{id:"thumbs_up",title:__("支持"),icon:"https://gw.alipayobjects.com/zos/basement_prod/40dd7f62-e6ad-48c6-b2c1-aeed729ff753.svg"},{id:"thumbs_down",title:__("反对"),icon:"https://gw.alipayobjects.com/zos/basement_prod/49753f89-a52b-47f8-8dff-ca2b7d5ab29e.svg"},{id:"applause",title:__("喝彩"),icon:"https://gw.alipayobjects.com/zos/basement_prod/39b96288-777c-4ad9-8065-fe27ee2366d5.svg"},{id:"momo",title:__("摸摸"),icon:"https://gw.alipayobjects.com/zos/basement_prod/486defba-93e3-4151-8b23-6fb09dfb7f97.svg"},{id:"+1",title:__("+1"),icon:"https://gw.alipayobjects.com/zos/bmw-prod/cd3682d7-3cc9-44a1-87d3-1feb83baee73.svg"},{id:"OK",title:"OK",icon:"https://gw.alipayobjects.com/zos/bmw-prod/70ec25dc-2ad6-42f3-b802-76ba015becde.svg"}],c=function(){var t={};return a.forEach((function(e){t[e.id]=e})),t}(),u={REACTIONS:a,getMoodTitleById:function(t){return(i[t]||{}).title||""},getPostUrl:function(t){var e=window.location.hash||"",r=window.location.href;return r=r.substring(0,r.length-e.length),"".concat(r,"#comment-").concat(t)},classifyReactions:function(t){var e=Object.keys(c),r={};return e.forEach((function(t){r[t]={count:0,user_ids:[]}})),t.forEach((function(t){t.action_option.split(",").forEach((function(e){r[e]&&(r[e].count++,r[e].user_ids.push(t.user_id))}))})),r},getReactionById:function(t){return c[t]}};e.a=u},2915:function(t,e,r){var n=r(1464)("toLowerCase");t.exports=n},2922:function(t,e,r){"use strict";r.r(e),r.d(e,"DocCreationGuide",(function(){return T})),r.d(e,"default",(function(){return R}));var n=r(2915),o=r.n(n),i=r(0),a=r(306),c=r(312),u=r(191),l=r(771),f=r(2923),s=r(2929),p=r(2272),y=r(991);function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function m(){m=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),c=new x(o||[]);return n(a,"_invoke",{value:j(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var s={};function p(){}function y(){}function h(){}var v={};u(v,i,(function(){return this}));var b=Object.getPrototypeOf,g=b&&b(b(C([])));g&&g!==e&&r.call(g,i)&&(v=g);var w=h.prototype=p.prototype=Object.create(v);function O(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function o(n,i,a,c){var u=f(t[n],t,i);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==d(s)&&r.call(s,"__await")?e.resolve(s.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(s).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function j(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=E(a,r);if(c){if(c===s)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=f(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function E(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,E(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),s;var o=f(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,s;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function C(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:L}}function L(){return{value:void 0,done:!0}}return y.prototype=h,n(w,"constructor",{value:h,configurable:!0}),n(h,"constructor",{value:y,configurable:!0}),y.displayName=u(h,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,u(t,c,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},O(_.prototype),u(_.prototype,a,(function(){return this})),t.AsyncIterator=_,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new _(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(w),u(w,c,"Generator"),u(w,i,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=C,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:C(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},t}function h(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function v(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){h(i,n,o,a,c,"next",t)}function c(t){h(i,n,o,a,c,"throw",t)}a(void 0)}))}}var b=new(r.n(y).a)(5);function g(t,e){return w.apply(this,arguments)}function w(){return w=v(m().mark((function t(e,r){var n,o,i,a=arguments;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a.length>2&&void 0!==a[2]?a[2]:5e3,!(o=b.get(e))){t.next=4;break}return t.abrupt("return",Promise.resolve(o));case 4:return t.next=6,r();case 6:return i=t.sent,b.set(e,i,{maxAge:n}),t.abrupt("return",i);case 9:case"end":return t.stop()}}),t)}))),w.apply(this,arguments)}function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}var _=["group","book","onUseTemplate","height","doc","isFullWidth","showRecent","needMore"],j=["visible","className","style"];function E(){return E=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},E.apply(this,arguments)}function S(t,e){if(null==t)return{};var r,n,o=function(t,e){if(null==t)return{};var r,n,o={},i=Object.keys(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||(o[r]=t[r]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o}function P(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function x(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?P(Object(r),!0).forEach((function(e){C(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function C(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==O(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===O(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function L(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return k(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var T=function(t){var e=t.group,r=t.book,n=t.onUseTemplate,y=t.height,d=(t.doc,t.isFullWidth),m=void 0===d||d,h=t.showRecent,v=void 0===h||h,b=t.needMore,w=void 0===b||b,O=S(t,_),j=function(t){var e=t.book,r=t.group,n=t.doc,a=t.showRecent,f=void 0===a||a,s=t.includePersonal,y=void 0===s||s,d=L(i.useState([]),2),m=d[0],h=d[1],v=L(i.useState({data:[],meta:{}}),2),b=v[0],w=v[1],O=(null==n?void 0:n.type)||"Doc";return i.useEffect((function(){var t;if(f){var r=function(){return c.a.editor.recentlyUpdatedDocs({book_id:e.id,type:O})};null!=e&&e.id&&null!=e&&null!==(t=e.abilities)&&void 0!==t&&t.create_doc?g("getRecentDocs-".concat(e.id,"-").concat(O),r,5e3).then((function(t){h(t)})):r().then((function(t){return h(t)}))}}),[e,f]),i.useEffect((function(){var t=p.a[o()(O)];g("getAllTemplates-".concat((null==e?void 0:e.id)||"","-").concat((null==r?void 0:r.id)||"","-").concat((null==e?void 0:e.organization_id)||"","-").concat(O||"","-").concat(t||""),(function(){return Object(l.j)(x(x({},Object(l.m)(e,r,y)),{},{official_channel:t,limit:5,format:u.TYPE_FORMAT_MAP[O]}))}),5e3).then((function(t){w(t)}))}),[e,O]),{recentDocs:m,templateConfig:b}}(t),P=j.recentDocs,C=j.templateConfig,k=L(i.useState(0),2),T=k[0],R=k[1],A=m?{}:{maxWidth:"890px",marginLeft:"auto",marginRight:"auto",paddingLeft:"70px",paddingRight:"70px"};return i.createElement("div",E({},O,{style:A}),i.createElement(a.a,{onResize:function(t){t.height&&R(t.height)}},i.createElement(f.c,{templateConfig:C,book:r,group:e,needMore:w,onUseTemplate:n})),v&&i.createElement(s.b,{height:y-T,recentDocs:P,book:r,group:e,onUseTemplate:n}))};function R(t){var e=t.visible,r=t.className,n=t.style,o=S(t,j);return e?i.createElement(T,E({},o,{className:r,style:n})):null}},2949:function(t,e,r){},2960:function(t,e,r){"use strict";r.d(e,"b",(function(){return s})),r.d(e,"a",(function(){return f}));var n=r(0),o=r.n(n),i=r(2),a=r(95),c="index-module_bookTips_cZ25F",u="index-module_groupTips_znta0",l="index-module_commentTips_eS4uK";function f(t){var e=t.targetType,r=o.a.createElement("a",{href:"https://www.yuque.com/yuque/cdgcvd/zsw0w0",className:"wording-comment-link",target:"_blank",style:{marginLeft:"8px"}},__("了解更多"));switch(e){case"Book":return o.a.createElement("span",{className:c,"data-testid":"forbid-tip"},__("注册 7 天后可设置为互联网可见 {learnMoreLink}",{learnMoreLink:r}));case"Group":return o.a.createElement("div",{className:u,"data-testid":"forbid-tip"},__("注册 7 天后，即可创建知识小组 {learnMoreLink}",{learnMoreLink:r}));default:return o.a.createElement("span",{className:l,"data-testid":"forbid-tip"},__("注册 7 天后即可参与{action} {learnMoreLink}",{action:"Topic"===e?__("讨论"):__("评论"),learnMoreLink:r}))}}function s(t,e){var r,n=window.appData,o=n.settings,i=void 0===o?{}:o,c=n.organization,u=n.isPublicCloud,l=e||{},f=l.me,s=void 0===f?window.appData.me||{}:f,p=l.group,y=void 0===p?window.appData.group:p,d=c&&c.id;y&&a.a.isGroupOrPublication(y)&&(r=y.abilities&&y.abilities.read_private);var m=t&&t.abilities&&t.abilities.update;return!!(u&&!d&&i.enable_new_user_public_ability_forbid&&s.isNewbie&&!r&&!m)}f.propTypes={targetType:i.PropTypes.string}},2988:function(t,e,r){"use strict";r.r(e);r(63);var n=r(23),o=(r(62),r(21)),i=(r(263),r(67)),a=(r(104),r(38)),c=r(0),u=r.n(c),l=r(2),f=r.n(l),s=r(570),p=r(622),y=r.n(p),d=r(228),m="ReportForm-module_container_CFFvb",h="ReportForm-module_title_NFreI",v="ReportForm-module_subtitle_iS17z",b="ReportForm-module_reportType_F9Aq+",g="ReportForm-module_reportTypeItem_fcNpj",w="ReportForm-module_btns_P3Kpd",O="ReportForm-module_reportReason_Ll05f",_="ReportForm-module_backBtn_Epa1y";function j(t){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(t)}function E(){E=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),c=new x(o||[]);return n(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var s={};function p(){}function y(){}function d(){}var m={};u(m,i,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(C([])));v&&v!==e&&r.call(v,i)&&(m=v);var b=d.prototype=p.prototype=Object.create(m);function g(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var u=f(t[n],t,i);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==j(s)&&r.call(s,"__await")?e.resolve(s.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(s).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function O(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=_(a,r);if(c){if(c===s)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=f(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function _(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),s;var o=f(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,s;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function C(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:L}}function L(){return{value:void 0,done:!0}}return y.prototype=d,n(b,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:y,configurable:!0}),y.displayName=u(d,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(w.prototype),u(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),u(b,c,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=C,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:C(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},t}function S(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function P(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return x(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return x(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function C(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function L(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,G(n.key),n)}}function k(t,e){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},k(t,e)}function T(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=N(t);if(e){var o=N(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return R(this,r)}}function R(t,e){if(e&&("object"===j(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return A(t)}function A(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function N(t){return N=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},N(t)}function I(t,e,r){return(e=G(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function G(t){var e=function(t,e){if("object"!==j(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==j(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===j(e)?e:String(e)}var D=[{name:__("含有广告等引导性内容"),type:"normal",code:d.REPORT_TYPE.ad},{name:__("含有辱骂等不友善内容"),type:"normal",code:d.REPORT_TYPE.abuse},{name:__("含有色情、淫秽内容"),type:"normal",code:d.REPORT_TYPE.vulgar},{name:__("含有反社会、血腥暴力等内容"),type:"normal",code:d.REPORT_TYPE.political},{name:__("“清朗”系列专项举报"),type:"normal",code:d.REPORT_TYPE.clearnet},{name:__("传播不实信息（政治类、财经类、疫情类等）"),type:"normal",code:d.REPORT_TYPE.infact},{name:__("国家企业敏感信息泄露"),type:"normal",code:d.REPORT_TYPE.sensitive},{name:__("其他违法犯罪（如毒品、枪支、违规借贷等）"),type:"normal",code:d.REPORT_TYPE.illegal},{name:__("侵犯知识产权"),type:"tort"}],F=[{name:__("个人侵权"),type:"tort",code:d.REPORT_TYPE.personal_tort},{name:__("企业侵权"),type:"tort",code:d.REPORT_TYPE.enterprise_tort}],M=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&k(t,e)}(l,t);var e,r,n,c=T(l);function l(){var t;C(this,l);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return I(A(t=c.call.apply(c,[this].concat(r))),"handleSubmit",(function(e){e.preventDefault();var r=t.props,n=r.onOk;(0,r.form.validateFields)((function(t,e){t||n(e)}))})),t}return e=l,(r=[{key:"render",value:function(){var t=this.props.form.getFieldDecorator;return u.a.createElement(i.a,null,u.a.createElement("div",{className:v},__("具体说明")),u.a.createElement(i.a.Item,{required:!1},t("reason",{validateFirst:!0,rules:[{required:!0,max:500,message:__("请输入举报原因（字数不多于500）")}]})(u.a.createElement(a.a.TextArea,{className:O,rows:5,maxLength:500,placeholder:__("举报原因（字数不多于 500）")}))),u.a.createElement("div",{className:w},u.a.createElement(o.a,{block:!0,onClick:this.props.onCancel},__("返回")),u.a.createElement(o.a,{block:!0,type:"primary",htmlType:"submit",onClick:this.handleSubmit},__("提交"))))}}])&&L(e.prototype,r),n&&L(e,n),Object.defineProperty(e,"prototype",{writable:!1}),l}(u.a.PureComponent);I(M,"propTypes",{onOk:f.a.func.isRequired,onCancel:f.a.func.isRequired,form:f.a.object.isRequired});var U=i.a.create()(M),V=function(t){var e=t.onCancel,r=t.onOk;return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:v},window.h5?__("侵权类举报请到 PC 端完成"):__("请选择类型")),!window.h5&&u.a.createElement("ul",{className:b},F.map((function(t,e){return u.a.createElement("li",{key:t.code||e,className:g,onClick:function(){return function(t){r(t)}(t)}},t.name)}))),u.a.createElement(o.a,{block:!0,className:_,onClick:function(){e()}},__("返回")))};V.propTypes={onOk:f.a.func.isRequired,onCancel:f.a.func.isRequired};var B=function(t){var e=P(Object(c.useState)(),2),r=e[0],o=e[1];function i(t,e){e.preventDefault(),o(t)}var a=function(e){return function(){var r,o=(r=E().mark((function r(o){var i,a;return E().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=window.appData.sharePage&&window.appData.share.token,"tort"!==e.type){r.next=6;break}return t.onClose(),a=y.a.stringify({report_type:o.code,target_id:t.targetId,target_type:t.targetType,token:i}),window.open("/r/content_reports?".concat(a)),r.abrupt("return");case 6:return r.next=8,t.dispatch({type:"proxy.web/contentReport.create",payload:{data:{report_type:e.code,target_id:t.targetId,target_type:t.targetType,token:i,meta:{reason:o.reason,referer_url:window.location.href}}}});case 8:t.onClose(),n.a.success(__("已收到你的举报，感谢反馈"));case 10:case"end":return r.stop()}}),r)})),function(){var t=this,e=arguments;return new Promise((function(n,o){var i=r.apply(t,e);function a(t){S(i,n,o,a,c,"next",t)}function c(t){S(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t){return o.apply(this,arguments)}}()};function l(){o(null)}return r?u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:h},r.name),"tort"===r.type?u.a.createElement(V,{onOk:a(r),onCancel:l}):u.a.createElement(U,{onOk:a(r),onCancel:l})):u.a.createElement("div",{className:m},u.a.createElement("div",{className:h},__("举报")),u.a.createElement("div",{className:v},__("请选举报原因")),u.a.createElement("ul",{className:b},D.map((function(t,e){return u.a.createElement("li",{key:t.code||e,onClick:i.bind(null,t)},u.a.createElement("div",{className:g},t.name))}))))};B.propTypes={targetId:f.a.number.isRequired,targetType:f.a.oneOf(["Doc"]).isRequired,onClose:f.a.func.isRequired};e.default=Object(s.d)()(B)},2991:function(t,e,r){"use strict";r(92);var n=r(45),o=r(0),i=r.n(o),a=r(2),c=r.n(a),u=r(198),l=r.n(u),f=r(570),s=r(2988);function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}var y=["children"];function d(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function m(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?d(Object(r),!0).forEach((function(e){h(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function h(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==p(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===p(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function v(){v=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof y?e:y,a=Object.create(i.prototype),c=new x(o||[]);return n(a,"_invoke",{value:j(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var s={};function y(){}function d(){}function m(){}var h={};u(h,i,(function(){return this}));var b=Object.getPrototypeOf,g=b&&b(b(C([])));g&&g!==e&&r.call(g,i)&&(h=g);var w=m.prototype=y.prototype=Object.create(h);function O(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function _(t,e){function o(n,i,a,c){var u=f(t[n],t,i);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==p(s)&&r.call(s,"__await")?e.resolve(s.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(s).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function j(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=E(a,r);if(c){if(c===s)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=f(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function E(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,E(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),s;var o=f(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,s;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function C(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:L}}function L(){return{value:void 0,done:!0}}return d.prototype=m,n(w,"constructor",{value:m,configurable:!0}),n(m,"constructor",{value:d,configurable:!0}),d.displayName=u(m,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,u(t,c,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},O(_.prototype),u(_.prototype,a,(function(){return this})),t.AsyncIterator=_,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new _(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(w),u(w,c,"Generator"),u(w,i,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=C,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:C(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},t}function b(){return b=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},b.apply(this,arguments)}function g(t,e){if(null==t)return{};var r,n,o=function(t,e){if(null==t)return{};var r,n,o={},i=Object.keys(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||(o[r]=t[r]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o}function w(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function O(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){w(i,n,o,a,c,"next",t)}function c(t){w(i,n,o,a,c,"throw",t)}a(void 0)}))}}function _(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return j(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var E=function(t){var e=_(Object(o.useState)(!1),2),r=e[0],a=e[1];function c(){a(!1)}function u(){return(u=O(v().mark((function e(){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.dispatch({type:"proxy.web/contentReport.check",payload:{data:{target_id:t.targetId,target_type:t.targetType,token:window.appData.sharePage&&window.appData.share.token}}});case 2:a(!0);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var l=t.children,f=g(t,y);return i.a.createElement(i.a.Fragment,null,l({onShowPanel:function(){return u.apply(this,arguments)}}),i.a.createElement(n.a,{destroyOnClose:!0,title:null,footer:null,visible:r,onCancel:c},i.a.createElement(s.default,b({},f,{onClose:c}))))};E.propTypes=m(m({},l()(s.default.propTypes,["targetId","targetType"])),{},{token:c.a.string,children:c.a.func.isRequired}),e.a=Object(f.d)()(E)},3023:function(t,e,r){"use strict";r(279);var n=r(136),o=r(0),i=r.n(o),a=r(2),c=r.n(a),u=r(9),l=r.n(u);r(2949);function f(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function p(t){var e=t.reaction,r=t.users,a=t.myReaction,c=f(Object(o.useState)(!1),2),u=c[0],s=c[1];return i.a.createElement(n.a,{className:"post-reaction-detail",overlayClassName:"post-reaction-detail-popover",getPopupContainer:function(t){return t.parentNode},mouseEnterDelay:.618,trigger:["hover"],placement:"bottomLeft",onVisibleChange:function(r){s(r),!1===r?t.reset(e.id):t.loadUsers(e.id)},visible:u,content:i.a.createElement("ul",{className:"post-reaction-users"},r.map((function(t){return i.a.createElement("li",{key:t.id},i.a.createElement("a",{href:"/".concat(t.login),target:"_blank"},t.name))})))},i.a.createElement("div",{onClick:t.onReactionClick,className:l()({"post-reaction-detail-type":!0,"post-reaction-detail-active":a&&a.reaction_types&&a.reaction_types.includes(e.id)})},i.a.createElement("img",{className:"post-interaction-icon",src:e.icon,height:20}),i.a.createElement("span",{className:"post-interaction-num"},t.total)))}p.defaultProps={onReactionClick:function(){}},p.propTypes={myReaction:c.a.object,users:c.a.array.isRequired,total:c.a.number.isRequired,reaction:c.a.object.isRequired,loadUsers:c.a.func.isRequired,reset:c.a.func.isRequired,onReactionClick:c.a.func},e.a=p},3024:function(t,e,r){"use strict";r(279);var n=r(136),o=r(0),i=r.n(o),a=r(2),c=r.n(a),u=r(2913),l=r(30);r(2949);function f(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var p=u.a.REACTIONS;function y(t){var e=t.active,r=t.totalReaction,a=t.reactionIcon,c=f(Object(o.useState)(!1),2),u=c[0],s=c[1];return i.a.createElement("div",{className:"post-reaction"},i.a.createElement(n.a,{getPopupContainer:function(t){return t.parentNode},trigger:window.h5?["click"]:["hover"],placement:t.placement,autoAdjustOverflow:!1,visible:u,arrowPointAtCenter:!0,onVisibleChange:function(t){s(t)},content:i.a.createElement("div",null,i.a.createElement("ul",{className:"post-reaction-items"},p.map((function(r){return i.a.createElement("li",{className:e.includes(r.id)?"post-reaction-active":"",key:r.id},i.a.createElement("img",{src:r.icon,onClick:function(){var n;n=r,e.includes(n.id)?t.onCancelReaction(n.id):t.onReaction(n.id),t.onReactionUpdate(n),s(!1)}}))}))))},i.a.createElement("div",null,i.a.createElement("span",{className:"post-reaction-entry"},a||i.a.createElement(l.b,{name:"comment-reaction",width:20,height:20})),r>0&&i.a.createElement("span",{className:"post-interaction-action-total"},r))))}y.defaultProps={onReactionUpdate:function(){}},y.propTypes={active:c.a.array,onReaction:c.a.func.isRequired,onCancelReaction:c.a.func.isRequired,onReactionUpdate:c.a.func,totalReaction:c.a.number,reactionIcon:c.a.element,placement:c.a.string},e.a=y},3025:function(t,e,r){"use strict";var n=r(0),o=r(106),i=r.n(o),a=r(105);function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function u(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function l(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==c(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===c(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function f(t){return function(t){if(Array.isArray(t))return y(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||p(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||p(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){if(t){if("string"==typeof t)return y(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(t,e):void 0}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var d=new i.a("thread:post.port");e.a=function(t){var e=t.me,r=t.comment,o=t.onReactionUpdate,i=s(Object(n.useState)(r.reactions||[]),2),c=i[0],p=i[1],y=s(Object(n.useState)({}),2),m=y[0],h=y[1],v=s(Object(n.useState)(!1),2),b=v[0],g=v[1],w="Comment";Object(n.useEffect)((function(){p(r.reactions||[])}),[r]);var O=function(){var t=null;return e&&e.id&&(t=c.find((function(t){return t.user_id===e.id})))&&(t.reaction_types=t.action_option.split(",")),t},_=function(t){return a.webProxy.actions.create({target_id:r.id,target_type:w,action_type:"reaction",action_option:t}).then((function(r){d("success",r);var n=c.filter((function(t){return t.user_id!==e.id}));n.push({user_id:e.id,action_type:"reaction",action_option:t}),p(n),o&&o(n,{actionType:"create",userId:e.id,actionOption:t})}))};return{state:{reactions:c,reactionUserMap:m},reaction:function(t){d("reaction",t);var e=t,r=O();if(r){var n=f(r.reaction_types);if(n.includes(t))return Promise.resolve({});n.push(t),e=n.join(",")}return _(e)},cancelReaction:function(t){d("cancel reaction:",t);var n=O();if(!n)return Promise.resolve({});var i=n.reaction_types.filter((function(e){return e!==t}));if(i.length>0){var u=i.join(",");return d("update action_option",i.join(",")),_(u)}return a.webProxy.actions.destroy({target_id:r.id,target_type:w,action_type:"reaction"}).then((function(){var r=c.filter((function(t){return t.user_id!==e.id}));p(r),o&&o(r,{actionType:"delete",userId:e.id,reactionType:t})}))},loadReactionUser:function(t){d("load users for reaction",t),b||(g(!0),a.webProxy.actions.users({target_id:r.id,target_type:w,action_type:"reaction",action_option:"".concat(t),limit:30}).then((function(e){var r=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?u(Object(r),!0).forEach((function(e){l(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},m);r[t]=e,g(!1),h(r)})))},resetReactionUser:function(t){h({})},getMyReaction:O}}},3051:function(t,e,r){"use strict";r.d(e,"b",(function(){return d})),r.d(e,"a",(function(){return s}));var n=r(34);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(i=n.key,a=void 0,a=function(t,e){if("object"!==o(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(i,"string"),"symbol"===o(a)?a:String(a)),n)}var i,a}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},c(t,e)}function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f(t);if(e){var o=f(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return l(this,r)}}function l(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function f(t){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},f(t)}var s={SCROLL:"SCROLL"},p=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}(l,t);var e,r,n,o=u(l);function l(){return a(this,l),o.apply(this,arguments)}return e=l,r&&i(e.prototype,r),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(r.n(n).a),y=new p;function d(){return y}},4349:function(t,e,r){"use strict";r.r(e);var n=r(0),o=r.n(n),i=r(36),a=r.n(i),c=r(570),u=r(9),l=r.n(u),f=r(30),s=(r(63),r(23)),p=r(2),y=r.n(p),d=r(54),m=r.n(d),h=r(3051),v=(r(62),r(21)),b=r(120),g=r.n(b),w=r(84),O=r.n(w),_=r(487),j=r.n(_),E=r(2817),S=r(2831),P=r(2960),x="Creator-module_createContainer_E9WwG",C="Creator-module_createBox_YJGH6",L="Creator-module_editorContainer_N1BzF",k="Creator-module_actions_CFe4H",T="Creator-module_actionItem_NsFQU",R="Creator-module_cancel_G++6L";function A(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return N(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return N(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var I={};function G(t){var e=I.useViewModel(t),r=e.state,n=Object(P.b)(t.doc);return o.a.createElement("div",{ref:r.creatorRef,className:x,"data-testid":"comment-creator",style:{position:"absolute",top:"".concat(r.offsetTop,"px")}},o.a.createElement("div",{className:C},o.a.createElement("div",{className:L},o.a.createElement(S.default,{editor:e.editor,onChange:e.onContentChange,onSubmit:e.createReply,onLoad:e.onLoad})),o.a.createElement("div",{className:k},o.a.createElement("div",{className:T},o.a.createElement(v.a,{type:"primary",disabled:r.isEmpty||r.loading||n,onClick:e.createReply},__("评论"))),o.a.createElement("div",{className:T},o.a.createElement(v.a,{className:R,onClick:e.cancelComment},__("取消")))),n&&o.a.createElement(P.a,null)))}I.useViewModel=function(t){var e=t.doc,r=t.selectedInfo,o=t.groupPosition,i=t.createComment,a=t.cancelComment,c=t.updateGroupPosition,u=t.getDefaultGroupArr,l=t.getDefaultPosition,f=t.getOffsetTop,s=t.transformAllGroup,p=t.clearAllGroupTransform,y=Object(n.useRef)(null),d=A(Object(n.useState)(!0),2),m=d[0],h=d[1],v=A(Object(n.useState)(!1),2),b=v[0],w=v[1],_=Object(n.useMemo)((function(){return new E.l({belong:e,placeholder:__("请添加评论...")})}),[e.id]),S=r.drawRanges[0],P=S.commentId,x=u(o),C=f(x,P);return Object(n.useEffect)((function(){var t=new ResizeObserver(g()((function(){var t=l(S),e=t.x,r=t.y;c({id:P,left:e,top:r,height:y.current.getBoundingClientRect().height});var n=u(o),i=f(n,P);i!==r?s(r-i):p()}),50));return t.observe(y.current),function(){t.disconnect()}}),[r]),Object(n.useEffect)((function(){setTimeout((function(){_.focus(!1)}),500)}),[r]),{state:{creatorRef:y,doc:e,isEmpty:m,loading:b,offsetTop:C},onContentChange:function(){h(_.isEmpty())},onLoad:function(){h(_.isEmpty())},createReply:function(){w(!0),_.contentReady().then((function(){_.isEmpty()||(i({commentable_type:"Doc",commentable_id:e.id,type:j.a.TYPE.WORDING_COMMENT,body_asl:_.getValue(),body:_.getHtml(),format:O.a.FORMAT.LAKE,selection:{paragraph_id:r.paragraphId,text_offset:r.textOffset,text:r.text,selection_range:{start:r.start,end:r.end}}}),_.reset(),w(!1))}))},cancelComment:a,editor:_}},G.propTypes={doc:y.a.object,selectedInfo:y.a.object,groupPosition:y.a.object,createComment:y.a.func,cancelComment:y.a.func,updateGroupPosition:y.a.func,getDefaultGroupArr:y.a.func,getDefaultPosition:y.a.func,getOffsetTop:y.a.func,transformAllGroup:y.a.func,clearAllGroupTransform:y.a.func};var D=G,F=r(2993),M=r(301),U=r(33),V=function(t,e){var r=t.doc_id,n=t.selection_id,o=Object(M.a)(U.a.docSelections.updateVisible).request;return{openSelection:function(t){return o({doc_id:r,selection_id:n,visible:!0}).then((function(){e({type:"litecomment/openSelectionById",payload:{selection_id:n,doc_id:r}}),t&&t()}))},closeSelection:function(t,i){return o({doc_id:r,selection_id:n,visible:!1}).then((function(){e({type:"litecomment/closeSelectionById",payload:{selection_id:n,doc_id:r}}),i&&i()}))}}};function B(t){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B(t)}function Y(){Y=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),c=new S(o||[]);return n(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var s={};function p(){}function y(){}function d(){}var m={};u(m,i,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(P([])));v&&v!==e&&r.call(v,i)&&(m=v);var b=d.prototype=p.prototype=Object.create(m);function g(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var u=f(t[n],t,i);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==B(s)&&r.call(s,"__await")?e.resolve(s.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(s).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function O(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return x()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=_(a,r);if(c){if(c===s)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=f(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function _(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),s;var o=f(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,s;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function P(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:x}}function x(){return{value:void 0,done:!0}}return y.prototype=d,n(b,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:y,configurable:!0}),y.displayName=u(d,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(w.prototype),u(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),u(b,c,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:P(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},t}function q(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}var z=function(t){var e=Object(n.useContext)(F.a),r=function(){var r,n=(r=Y().mark((function r(n){var o;return Y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t({type:"proxy.web/comments.create",payload:{data:n}});case 2:if((o=r.sent).id){r.next=5;break}return r.abrupt("return");case 5:return r.next=7,t({type:"litecomment/create",payload:{data:o,showEditorAtBottom:!0,commentListStyle:"floor"}});case 7:return null==e||e.createComment(o),t({type:"doc/addCommentCount"}),r.abrupt("return",o);case 10:case"end":return r.stop()}}),r)})),function(){var t=this,e=arguments;return new Promise((function(n,o){var i=r.apply(t,e);function a(t){q(i,n,o,a,c,"next",t)}function c(t){q(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t){return n.apply(this,arguments)}}();return{createComment:r,updateComment:function(r,n){return t({type:"proxy.web/comments.update",payload:{data:r}}).then((function(){n&&n(),t({type:"litecomment/updateOne",payload:r}),null==e||e.updateComment(r)}))},deleteComment:function(r,n){return t({type:"proxy.web/comments.destroy",payload:{data:{id:r},reducer:"litecomment/remove"}}).then((function(){t({type:"doc/reduceCommentCount"}),n&&n(),null==e||e.destroyComment({id:r})}))}}},H=(r(103),r(60)),K=(r(279),r(136)),W=(r(280),r(102)),$=(r(166),r(31)),Z=r(288),J=r.n(Z),Q=r(3025),X=r(2913),tt=r(3024),et=r(2773),rt=r(2909),nt=r(1458),ot=r(272),it=r(2991),at=r(254),ct=r(3023),ut=X.a.REACTIONS;function lt(t){var e=t.comment,r=t.onReactionUpdate,n=t.reactionMap,i=t.reactions,a=t.myReaction,c=t.reactionViewModel,u=t.reactionUserMap;return i.length>0?o.a.createElement("div",{className:"post-interaction",style:{marginTop:12}},o.a.createElement("div",{className:"post-interaction-reaction-summary"},o.a.createElement("ul",null,ut.map((function(t){var i=n[t.id].count;return 0===i?null:o.a.createElement("li",{key:t.id},o.a.createElement(ct.a,{myReaction:a,reaction:t,users:u[t.id]||[],total:i,loadUsers:function(){c.loadReactionUser(t.id)},reset:function(){c.resetReactionUser(t.id)},onReactionClick:function(){(a&&a.action_option.includes(t.id)?c.cancelReaction(t.id):c.reaction(t.id)).then((function(){c.loadReactionUser(t.id),r(t,e)}))}}))}))))):null}lt.defaultProps={onReactionUpdate:function(){}},lt.propTypes={comment:y.a.object.isRequired,onReactionUpdate:y.a.func,reactionMap:y.a.object.isRequired,reactions:y.a.array.isRequired,myReaction:y.a.object.isRequired,reactionViewModel:y.a.object.isRequired,reactionUserMap:y.a.object.isRequired};var ft=lt,st={editorViewContainer:"EditView-module_editorViewContainer_tCK3o",actions:"EditView-module_actions_TAmbV",actionItem:"EditView-module_actionItem_wxvcy",cancel:"EditView-module_cancel_i+xST"};function pt(t){return pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pt(t)}function yt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function dt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?yt(Object(r),!0).forEach((function(e){mt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):yt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function mt(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==pt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==pt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===pt(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ht(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return vt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var bt={};function gt(t){var e=bt.useViewModel(t),r=e.state;return o.a.createElement("div",{className:st.editorViewContainer},o.a.createElement("div",{className:st.editorWrapper},o.a.createElement(S.default,{editor:e.editor,onChange:e.onContentChange,onSubmit:e.update})),o.a.createElement("div",{className:st.actions},o.a.createElement("div",{className:st.actionItem},o.a.createElement(v.a,{type:"primary","data-testid":"comment-edit-submit",disabled:r.isEmpty||r.loading,onClick:e.update},__("确定"))),o.a.createElement("div",{className:st.actionItem},o.a.createElement(v.a,{className:st.cancel,onClick:e.cancelEdit},__("取消")))))}bt.useViewModel=function(t){var e=t.comment,r=t.cancelEdit,o=t.updateComment,i=t.doc,a=ht(Object(n.useState)(!1),2),c=a[0],u=a[1],l=ht(Object(n.useState)(!1),2),f=l[0],s=l[1],p=Object(n.useMemo)((function(){return new E.l({target:e,belong:i})}),[i.id]);return{state:{doc:i,comment:e,isEmpty:c,loading:f},update:function(){s(!0),p.contentReady().then((function(){o(dt(dt({},e),{},{body_asl:p.getValue(),body:p.getHtml(),format:O.a.FORMAT.LAKE}))}))},onContentChange:function(){u(p.isEmpty())},cancelEdit:r,editor:p}},gt.propTypes={comment:y.a.object,cancelEdit:y.a.func,updateComment:y.a.func};var wt=gt,Ot={groupItemContainer:"CommentGroupItem-module_groupItemContainer_hcFs5",avatar:"CommentGroupItem-module_avatar_sZcW2",main:"CommentGroupItem-module_main_LL-Xw",name:"CommentGroupItem-module_name_9c70h",arrow:"CommentGroupItem-module_arrow_u0PYm",time:"CommentGroupItem-module_time_KbowO",content:"CommentGroupItem-module_content_KAu25",actions:"CommentGroupItem-module_actions_eyLP8",moreAction:"CommentGroupItem-module_moreAction_l2lcj",actionItem:"CommentGroupItem-module_actionItem_C4Epa",withoutMarginRight:"CommentGroupItem-module_withoutMarginRight_Z0YBO",replyContainer:"CommentGroupItem-module_replyContainer_R7zLP",editContainer:"CommentGroupItem-module_editContainer_qHYQX"};function _t(t){return _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_t(t)}function jt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Et(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?jt(Object(r),!0).forEach((function(e){St(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):jt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function St(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==_t(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==_t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===_t(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Pt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return xt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Ct={useViewModel:function(t){var e=t.comment,r=t.deleteComment,o=t.updateComment,i=t.me,a=t.doc,c=t.visibility,u=t.index,l=t.reply,f=t.dispatch,p=Object(n.useContext)(F.a),y=Pt(Object(n.useState)("view"),2),d=y[0],m=y[1],h=Pt(Object(n.useState)(!0),2),v=h[0],b=h[1],g=Object(Q.a)({me:i,comment:e,onReactionUpdate:function(t,r){var n=Et(Et({},e),{},{reactions:t});f({type:"litecomment/updateOne",payload:n}),null==p||p.updateReaction(null,n,r)}}),w=g.state,O=w.reactions,j=w.reactionUserMap,E=Object(n.useMemo)((function(){var t={reactionMap:X.a.classifyReactions(O),myReaction:g.getMyReaction(),totalReaction:0};return Object.keys(t.reactionMap).forEach((function(e){t.totalReaction+=t.reactionMap[e].count})),t}),[O]),S=E.reactionMap,P=E.myReaction,x=void 0===P?{}:P,C=!(!i||!i.id);return Object(n.useEffect)((function(){c&&b(!1)}),[c]),{state:{doc:a,me:i,comment:e,loading:v,mode:d,hasLogin:C,index:u,reactionMap:S,myReaction:x,reactions:O,reactionUserMap:j},reactionViewModel:g,deleteComment:function(){r(e.id)},update:function(t){o(t),m("view")},edit:function(){m("edit")},cancelEdit:function(){m("view")},replyTo:function(){return l(e)},canDelete:function(){return!!i&&(i.id===e.user_id||a.abilities&&a.abilities.destroy_comment)},canEdit:function(){return i&&i.id===e.user_id},canReport:function(){if(!window.appData.isPublicCloud)return!1;var t=Object(rt.a)()||Object(rt.b)();return e.status===_.STATUS.normal&&t&&i&&i.id!==e.user_id},copyLink:function(t){try{J()(t),s.a.success(__("评论链接已复制"))}catch(t){}},onReactionUpdate:function(){}}}},Lt=function(t){var e=t.state.comment,r=et.a.getAnchorId(e.id,"Doc"),n=window.location,i=n.protocol,a=n.host,c=n.pathname,u="".concat(i,"//").concat(a).concat(c,"#").concat(r);return o.a.createElement($.a,null,o.a.createElement($.a.Item,{key:"copy"},o.a.createElement("span",{onClick:function(){t.copyLink(u)}},__("复制评论链接"))),t.canReport()&&o.a.createElement($.a.Item,{key:"report"},o.a.createElement(it.a,{targetId:e.id,targetType:"Comment"},(function(t){return o.a.createElement("span",{className:"action-link",onClick:t.onShowPanel},__("举报"))}))))},kt=function(t){var e=Ct.useViewModel(t),r=e.reactionViewModel,n=e.onReactionUpdate,i=e.state,a=i.index,c=i.comment,u=i.loading,s=i.mode,p=i.hasLogin,y=i.doc,d=i.reactionMap,m=i.myReaction,h=i.reactions,v=i.reactionUserMap,b=c.user,g=c.to_user,w=o.a.createRef();if("view"===s){var O=l()("comment-item-".concat(a),Ot.groupItemContainer);return o.a.createElement(o.a.Fragment,null,c&&null===c.deleted_at&&o.a.createElement("div",{className:O,"data-testid":"comment-item",ref:w},o.a.createElement("div",{className:Ot.avatar},o.a.createElement(at.a,{src:b&&b.avatar_url,size:24,name:b.name})),o.a.createElement("div",{className:Ot.main},o.a.createElement("div",{className:Ot.info},o.a.createElement("div",{className:Ot.name},o.a.createElement("span",null,b.name),g&&o.a.createElement(o.a.Fragment,null,o.a.createElement(f.b,{className:Ot.arrow,name:"review-arrow-right",size:16}),o.a.createElement("span",null,g.name))),o.a.createElement("div",{className:Ot.time},o.a.createElement(ot.a,{time:c.created_at}))),o.a.createElement("div",{className:Ot.content},!u&&o.a.createElement(nt.default,{id:c.id,content:c.body_asl,genOutline:!1,genAnchor:!1,simpleUI:!0})),p&&o.a.createElement(ft,{comment:c,onReactionUpdate:n,reactionViewModel:r,myReaction:m,reactionMap:d,reactions:h,reactionUserMap:v}),p&&o.a.createElement("div",{className:Ot.actions},o.a.createElement("span",{className:Ot.actionItem,onClick:e.replyTo},o.a.createElement(f.b,{name:"comment-bubble",color:"#8C8C8C",width:16,height:16})),o.a.createElement(tt.a,{reactionIcon:o.a.createElement("span",{className:l()(Ot.actionItem,Ot.withoutMarginRight)},o.a.createElement(f.b,{className:Ot.action,name:"comment-reaction",color:"#8C8C8C",width:16,height:16})),active:(null==m?void 0:m.reaction_types)||[],onReaction:r.reaction,onCancelReaction:r.cancelReaction,onReactionUpdate:function(t){return n(t,c)}}),o.a.createElement("span",{className:Ot.moreAction},e.canEdit()&&o.a.createElement("span",{className:Ot.actionItem,onClick:e.edit},o.a.createElement(f.b,{name:"edit-border",color:"#8C8C8C",width:16,height:16})),e.canDelete()&&o.a.createElement(W.a,{title:__("确认删除该评论么？"),placement:"bottom",onConfirm:e.deleteComment},o.a.createElement("span",{className:Ot.actionItem},o.a.createElement(f.b,{name:"icon-delete",color:"#8C8C8C",width:16,height:16}))),o.a.createElement(K.a,{type:"menu",getPopupContainer:function(t){return t.parentNode},placement:"bottomRight",arrowPointAtCenter:!0,trigger:["hover"],content:Lt(e)},o.a.createElement("span",{className:Ot.actionItem},o.a.createElement(f.b,{name:"comment-more",color:"#8C8C8C",width:16,height:16}))))))))}return o.a.createElement("div",{style:{paddingLeft:16,paddingRight:16}},o.a.createElement(wt,{doc:y,comment:c,cancelEdit:e.cancelEdit,updateComment:e.update}))};kt.propTypes={index:y.a.number,comment:y.a.object,me:y.a.object,doc:y.a.object,rootComment:y.a.object,deleteComment:y.a.func,updateComment:y.a.func,highlight:y.a.func,reply:y.a.func,dispatch:y.a.func};var Tt=kt,Rt="ReplyCreator-module_replyCreatorContainer_NQ4sK",At="ReplyCreator-module_editorContainer_Tvxsn",Nt="ReplyCreator-module_actions_pnqDv",It="ReplyCreator-module_actionItem_UHAql",Gt="ReplyCreator-module_cancel_ARRnU",Dt="ReplyCreator-module_replyingInfo_RH86T",Ft="ReplyCreator-module_wrapper_uNAur",Mt="ReplyCreator-module_name_Pay8V";function Ut(t){return Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ut(t)}function Vt(){Vt=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),c=new S(o||[]);return n(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var s={};function p(){}function y(){}function d(){}var m={};u(m,i,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(P([])));v&&v!==e&&r.call(v,i)&&(m=v);var b=d.prototype=p.prototype=Object.create(m);function g(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var u=f(t[n],t,i);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Ut(s)&&r.call(s,"__await")?e.resolve(s.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(s).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function O(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return x()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=_(a,r);if(c){if(c===s)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=f(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function _(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),s;var o=f(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,s;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function P(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:x}}function x(){return{value:void 0,done:!0}}return y.prototype=d,n(b,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:y,configurable:!0}),y.displayName=u(d,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(w.prototype),u(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),u(b,c,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:P(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},t}function Bt(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Yt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return qt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function zt(t){var e=t.doc,r=t.createComment,o=t.replyingTo,i=t.parent_id,a=t.root_id,c=t.cancelReply,u=Yt(Object(n.useState)(!0),2),l=u[0],f=u[1],s=Yt(Object(n.useState)(!1),2),p=s[0],y=s[1],d=Object(n.useMemo)((function(){return new E.l({belong:e,placeholder:__("请添加评论...")})}),[e.id]),m=function(){var t,n=(t=Vt().mark((function t(){return Vt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return y(!0),t.next=3,d.contentReady();case 3:if(!d.isEmpty()){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,r({commentable_type:"Doc",commentable_id:e.id,type:j.a.TYPE.WORDING_COMMENT,body_asl:d.getValue(),body:d.getHtml(),format:O.a.FORMAT.LAKE,parent_id:i,root_id:a,to_user_id:o.id});case 7:d.clearCache();case 8:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Bt(i,n,o,a,c,"next",t)}function c(t){Bt(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(){return n.apply(this,arguments)}}();return{state:{doc:e,isEmpty:l,replyingTo:o,loading:p},onContentChange:function(){f(d.isEmpty())},createReply:m,editorOnload:function(){d.focus(!0)},cancelReply:c,editor:d}}function Ht(t){var e=zt(t),r=e.state,n=Object(P.b)(t.doc);return o.a.createElement("div",{className:Rt,"data-testid":"select-word-comment"},o.a.createElement("div",{className:At},o.a.createElement(S.default,{editor:e.editor,onChange:e.onContentChange,onSubmit:e.createReply,onLoad:e.editorOnload})),o.a.createElement("div",{className:Nt},o.a.createElement("div",{className:It},o.a.createElement(v.a,{type:"primary",disabled:r.isEmpty||r.loading||n,onClick:e.createReply},__("回复"))),o.a.createElement("div",{className:It},o.a.createElement(v.a,{className:Gt,onClick:e.cancelReply},__("取消"))),o.a.createElement("div",{className:Dt},o.a.createElement("div",{className:Ft},o.a.createElement("span",null,__("回复")," "),o.a.createElement("span",{className:Mt},"@",r.replyingTo&&r.replyingTo.name)))),n&&o.a.createElement(P.a,null))}Ht.propTypes={doc:y.a.object,selectedInfo:y.a.object,createComment:y.a.func,replyingTo:y.a.object,parent_id:y.a.number,root_id:y.a.number,cancelReply:y.a.func};var Kt=Ht,Wt="CommentGroup-module_groupContainer_KczOF",$t="CommentGroup-module_groupBox_Rwdmw",Zt="CommentGroup-module_header_fIsOp",Jt="CommentGroup-module_title_ptcf0",Qt="CommentGroup-module_actionsBtnGroup_r9Otd",Xt="CommentGroup-module_actionBtn_eImZP",te="CommentGroup-module_close_oU6Vu",ee="CommentGroup-module_action_wOOTd",re="CommentGroup-module_disable_Il+lS",ne="CommentGroup-module_active_htoNq",oe="CommentGroup-module_visible_+GH4-";function ie(t){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ie(t)}function ae(){ae=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),c=new S(o||[]);return n(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var s={};function p(){}function y(){}function d(){}var m={};u(m,i,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(P([])));v&&v!==e&&r.call(v,i)&&(m=v);var b=d.prototype=p.prototype=Object.create(m);function g(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var u=f(t[n],t,i);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==ie(s)&&r.call(s,"__await")?e.resolve(s.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(s).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function O(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return x()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=_(a,r);if(c){if(c===s)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=f(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function _(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),s;var o=f(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,s;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function P(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:x}}function x(){return{value:void 0,done:!0}}return y.prototype=d,n(b,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:y,configurable:!0}),y.displayName=u(d,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(w.prototype),u(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),u(b,c,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:P(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},t}function ce(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ue(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ce(Object(r),!0).forEach((function(e){le(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ce(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function le(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==ie(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==ie(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===ie(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function fe(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function se(t){return function(t){if(Array.isArray(t))return de(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||ye(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pe(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||ye(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ye(t,e){if(t){if("string"==typeof t)return de(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?de(t,e):void 0}}function de(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function me(t){var e=t.doc,r=t.me,o=t.visibility,i=t.comment,a=t.groupArr,c=t.deleteComment,u=t.updateComment,l=t.createReply,f=t.closeSelection,s=t.activeSelectionId,p=t.offsetTop,y=t.focusGroup,d=t.focusPrevGroup,m=t.focusNextGroup,h=pe(Object(n.useState)(null),2),v=h[0],b=h[1],g=e&&e.abilities&&e.abilities.update,w=i.id,O=i.selection_id,_=se(i.sub_comments).sort((function(t,e){return new Date(t.created_at)-new Date(e.created_at)}))||[],j=[i].concat(se(_)),E=a.findIndex((function(t){return t.id===w})),S=0===E,P=E===a.length-1,x=function(){b(null)},C=function(){var t,e=(t=ae().mark((function t(e){var r;return ae().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(v){t.next=2;break}return t.abrupt("return");case 2:return r=v.selection,t.next=5,l(ue(ue({},e),{},{selection:{paragraph_id:r.paragraph_id,range_rect:r.range_rect,text_offset:r.text_offset,text:r.text,selection_range:r.selection_range}}));case 5:x();case 6:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){fe(i,n,o,a,c,"next",t)}function c(t){fe(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t){return e.apply(this,arguments)}}();return{state:{doc:e,me:r,visibility:o,canUpdate:g,id:w,selection_id:O,comment:i,comments:j,deleteComment:c,updateComment:u,createReply:l,closeSelection:f,activeSelectionId:s,offsetTop:p,focusGroup:y,focusPrevGroup:d,focusNextGroup:m,replyingComment:v,isFirstGroup:S,isLastGroup:P},reply:function(t){b(t)},cancelReply:x,createComment:C}}var he=o.a.forwardRef((function(t,e){var r=me(t),n=r.state,i=r.reply,a=r.cancelReply,c=r.createComment,u=n.canUpdate,s=n.id,p=n.visibility,y=n.selection_id,d=n.comment,m=n.comments,h=n.deleteComment,v=n.updateComment,b=n.closeSelection,g=n.activeSelectionId,w=n.doc,O=n.me,_=n.offsetTop,j=n.focusGroup,E=n.focusPrevGroup,S=n.focusNextGroup,P=n.replyingComment,x=n.isFirstGroup,C=n.isLastGroup,L=l()(Wt,y===g?ne:"",p?oe:"");return o.a.createElement("div",{className:L,ref:e,"data-comment-group-id":s,style:{position:"absolute",top:"".concat(_,"px")}},o.a.createElement("div",{className:$t,onClick:function(){j(s,y)}},o.a.createElement("div",{className:Zt},o.a.createElement("div",{className:Jt},__("{count} 条评论",{count:m.filter((function(t){return null===t.deleted_at})).length})),y===g&&o.a.createElement("div",{className:Qt},o.a.createElement("div",{className:Xt},x?o.a.createElement("div",{className:l()(ee,re),onClick:function(){E()}},o.a.createElement(f.b,{name:"arrow-up",width:16,height:16})):o.a.createElement(H.a,{title:__("上一条"),placement:"topLeft",arrowPointAtCenter:!0},o.a.createElement("div",{className:l()(ee),onClick:function(){E()}},o.a.createElement(f.b,{name:"arrow-up",width:16,height:16})))),o.a.createElement("div",{className:Xt},C?o.a.createElement("div",{className:l()(ee,re),onClick:function(){S()}},o.a.createElement(f.b,{name:"arrow-down",width:16,height:16})):o.a.createElement(H.a,{title:__("下一条"),placement:"top",arrowPointAtCenter:!0},o.a.createElement("div",{className:l()(ee),onClick:function(){S()}},o.a.createElement(f.b,{name:"arrow-down",width:16,height:16})))),u&&o.a.createElement("div",{className:l()(Xt,te)},o.a.createElement(H.a,{title:__("标记为隐藏"),placement:"topRight",arrowPointAtCenter:!0},o.a.createElement("div",{className:ee,onClick:function(){b(y)}},o.a.createElement(f.b,{name:"comment-hide",width:16,height:16})))))),m.map((function(e,r){return o.a.createElement(Tt,{doc:w,me:O,key:e.id,visibility:p,comment:e,rootComment:d,deleteComment:h,updateComment:v,index:r,reply:i,dispatch:t.dispatch})})),P&&o.a.createElement(Kt,{doc:w,me:O,replyingTo:P.user,createComment:c,parent_id:P.id,root_id:s,cancelReply:a})))}));he.propTypes={doc:y.a.object,me:y.a.object,visibility:y.a.bool,comment:y.a.object,groupArr:y.a.array,deleteComment:y.a.func,updateComment:y.a.func,createReply:y.a.func,closeSelection:y.a.func,activeSelectionId:y.a.number,offsetTop:y.a.number,focusGroup:y.a.func,focusPrevGroup:y.a.func,focusNextGroup:y.a.func,dispatch:y.a.func};var ve=he,be="SideCommentItem-module_selectionInfo_EkyqK",ge="SideCommentItem-module_text_8tA08",we="SideCommentItem-module_action_xPcKj";function Oe(t){return Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oe(t)}function _e(){_e=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),c=new S(o||[]);return n(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var s={};function p(){}function y(){}function d(){}var m={};u(m,i,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(P([])));v&&v!==e&&r.call(v,i)&&(m=v);var b=d.prototype=p.prototype=Object.create(m);function g(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var u=f(t[n],t,i);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Oe(s)&&r.call(s,"__await")?e.resolve(s.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(s).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function O(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return x()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=_(a,r);if(c){if(c===s)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=f(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function _(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),s;var o=f(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,s;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function P(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:x}}function x(){return{value:void 0,done:!0}}return y.prototype=d,n(b,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:y,configurable:!0}),y.displayName=u(d,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(w.prototype),u(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),u(b,c,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:P(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},t}function je(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Ee(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Se(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ee(Object(r),!0).forEach((function(e){Pe(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ee(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Pe(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==Oe(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Oe(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function xe(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Ce(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ce(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ce(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Le(t){var e,r=t.doc,i=t.me,a=t.comment,c=t.engine,u=t.activeSelectionId,l=t.groupArr,f=t.dispatch,p=t.getDrawRange,y=t.getDefaultPosition,d=t.updateGroupPosition,m=t.deteleGroupPosition,h=t.focusGroup,v=t.focusPrevGroup,b=t.focusNextGroup,w=a.id,O=a.selection_id,_=Object(n.useContext)(F.a),j=Object(n.useRef)(null),E=xe(Object(n.useState)(null),2),S=E[0],P=E[1],x=xe(Object(n.useState)(!window.IntersectionObserver),2),C=x[0],L=x[1],k=z(f),T=k.createComment,R=k.updateComment,A=k.deleteComment,N=V({doc_id:r.id,selection_id:O},f),I=N.openSelection,G=N.closeSelection,D=function(){return I((function(){P(!0),s.a.destroy(),null==_||_.updateComment(Se(Se({},a),{},{closed_at:null}))}))},M=function(){var t=p(w);t&&c._iViewer.selectWording([t.viewRange],w,O)};Object(n.useEffect)((function(){if(window.ResizeObserver&&j.current){var t=new ResizeObserver(g()((function(){var t=p(w),e=y(t),r=e.x,n=e.y;j.current&&d({id:w,left:r,top:n,height:j.current.getBoundingClientRect().height})}),50));return t.observe(j.current),function(){t.disconnect()}}}),[]),Object(n.useEffect)((function(){if(window.IntersectionObserver&&j.current){var t=new IntersectionObserver(g()((function(t,e){t.forEach((function(t){t.isIntersecting?L(!0):L(!1)}))}),50));return t.observe(j.current),function(){t.disconnect()}}}),[S]);var U,B,Y=(null===(e=l.find((function(t){return t.id===w})))||void 0===e?void 0:e.top)||0;return{state:{doc:r,me:i,activeSelectionId:u,visible:S,visibility:C,groupRef:j,comment:a,groupArr:l,offsetTop:Y},createComment:(U=_e().mark((function t(e){return _e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T(e);case 2:P(!0),M();case 4:case"end":return t.stop()}}),t)})),B=function(){var t=this,e=arguments;return new Promise((function(r,n){var o=U.apply(t,e);function i(t){je(o,r,n,i,a,"next",t)}function a(t){je(o,r,n,i,a,"throw",t)}i(void 0)}))},function(t){return B.apply(this,arguments)}),updateComment:function(t){return R(t,(function(){M()}))},deleteComment:function(t){return A(t,(function(){m({id:t}),M(),s.a.success(__("操作成功"),3)}))},closeSelection:function(t){return G(t,(function(){P(!1),s.a.warn(o.a.createElement("div",{className:be},o.a.createElement("span",{className:ge},__("不再显示此处的划词评论，但仍将在下方评论处展示")),o.a.createElement("span",{onClick:D,className:we},__("撤销"))),3),null==_||_.updateComment(Se(Se({},a),{},{closed_at:(new Date).toISOString()}))}))},focusGroup:h,focusPrevGroup:v,focusNextGroup:b}}var ke=o.a.memo((function(t){var e=Le(t),r=e.state,n=r.comment;return(null!==r.visible?!r.visible:n&&n.selection&&n.selection.closed_at)?null:o.a.createElement(ve,{ref:r.groupRef,doc:r.doc,me:r.me,visibility:r.visibility,comment:n,groupArr:r.groupArr,deleteComment:e.deleteComment,updateComment:e.updateComment,createReply:e.createComment,closeSelection:e.closeSelection,activeSelectionId:r.activeSelectionId,offsetTop:r.offsetTop,focusGroup:e.focusGroup,focusPrevGroup:e.focusPrevGroup,focusNextGroup:e.focusNextGroup,dispatch:t.dispatch})}));ke.propTypes={doc:y.a.object,me:y.a.object,activeSelectionId:y.a.number,dispatch:y.a.func,comment:y.a.object,engine:y.a.object,groupArr:y.a.array,getDrawRange:y.a.func,getDefaultPosition:y.a.func,updateGroupPosition:y.a.func,deteleGroupPosition:y.a.func,focusGroup:y.a.func,focusPrevGroup:y.a.func,focusNextGroup:y.a.func};var Te=ke;function Re(t){return Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Re(t)}function Ae(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Ne(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ne(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ne(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ie(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ge(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ie(Object(r),!0).forEach((function(e){De(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ie(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function De(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==Re(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Re(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Re(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Fe=function(t,e){var r=e.type,n=e.payload;switch(r){case"select":return Ge(Ge({},t),n);case"reset":return{text:"",paragraphId:null,textOffset:null,start:null,end:null,drawRanges:[]}}};function Me(t){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Me(t)}function Ue(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Ve(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ve(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ve(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Be(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ye(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Be(Object(r),!0).forEach((function(e){qe(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Be(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function qe(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==Me(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Me(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Me(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ze=function(t,e){var r=e.type,n=e.payload,o=n.id,i=n.top,a=n.left,c=n.height;switch(r){case"update":return t[o]={top:i,left:a,height:c},Ye({},t);case"delete":var u=Ye({},t);return delete u[o],u;case"reset":return{}}},He="SideCommentList-module_commentListWrapper_fE+ZY";function Ke(t){return Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ke(t)}function We(){We=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),c=new S(o||[]);return n(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var s={};function p(){}function y(){}function d(){}var m={};u(m,i,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(P([])));v&&v!==e&&r.call(v,i)&&(m=v);var b=d.prototype=p.prototype=Object.create(m);function g(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var u=f(t[n],t,i);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Ke(s)&&r.call(s,"__await")?e.resolve(s.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(s).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function O(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return x()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=_(a,r);if(c){if(c===s)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=f(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function _(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),s;var o=f(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,s;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function P(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:x}}function x(){return{value:void 0,done:!0}}return y.prototype=d,n(b,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:y,configurable:!0}),y.displayName=u(d,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(w.prototype),u(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),u(b,c,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),E(r),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:P(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},t}function $e(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Ze(t){return function(t){if(Array.isArray(t))return Je(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Je(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Je(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Je(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Qe(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Xe(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==Ke(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Ke(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Ke(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function tr(t){var e,r,o,i=t.getEngine,a=t.doc,c=t.me,u=t.wordingComments,l=t.wordingList,f=t.flattenFloorComments,p=t.dispatch,y=t.sideCommentState,d=t.dispatchSideComment,v=z(p).createComment,b={selectedInfo:(e=Ae(Object(n.useReducer)(Fe,{text:"",paragraphId:null,textOffset:null,start:null,end:null,drawRanges:[]}),2))[0],dispatch:e[1]},g=b.selectedInfo,w=b.dispatch,O=function(){var t=Ue(Object(n.useReducer)(ze,{}),2);return{groupPosition:t[0],dispatch:t[1]}}(),_=O.groupPosition,j=O.dispatch,E=y.creatorVisible,S=y.activeCommentId,P=y.activeSelectionId,x=Object(n.useRef)(null),C=function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},L=function(t){var e=Object.entries(t).sort((function(t,e){return t[1].top<e[1].top?-1:t[1].top>e[1].top?1:t[1].left-e[1].left})).map((function(t){return function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Qe(Object(r),!0).forEach((function(e){Xe(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Qe(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({id:+t[0]},t[1])}));return e},k=function(t,e){for(var r=0,n=0;n<t.length;n++){var o=t[n];if(o.id===e){o.top>r&&(r=o.top);break}r=o.top>=r?o.top+o.height+20:r+o.height+20}return r},T=function(t){return i()._iViewer.getAllDrawRanges().find((function(e){return e.commentId===t}))},R=function(t){if(!t)return{x:0,y:0};var e=t.rects.filter((function(t){return!(0===t.width&&t.x<0)})).reduce((function(t,e){return t.concat(e.y)}),[]);if(0===e.length){var r=i()._iViewer.getRootCollapsedDOMNode(t.viewRange.start.node);e=r?[r.getBoundingClientRect().y]:[0]}return{x:t.rects[0].x,y:Math.min.apply(Math,Ze(e))}},A=function(t){d({type:"transform",payload:{translateY:t}})},N=function(){d({type:"resetTransform"})},I=function(t){var e=t.paragraphId,r=t.text,n=t.textOffset,o=t.start,i=t.end,a=t.drawRanges;d({type:"showCreator",payload:{selectionId:a[0].selectionId,commentId:a[0].commentId}}),w({type:"select",payload:{paragraphId:e,text:r,textOffset:n,start:o,end:i,drawRanges:a}})},G=function(){d({type:"hideCreator"}),j({type:"delete",payload:{id:0}}),w({type:"reset"})},D=function(){G(),i()._iViewer.clearHighlightWording()},F=function(t){var e=t.commentId,r=t.selectionId;G(),d({type:"focusComment",payload:{selectionId:r,commentId:e}})},M=function(){S&&P&&d({type:"unfocusComment"})},U=m()((function(t){document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&(0===C()&&N())}),50),V=function(t){var e=C()+i()._iViewer.domRootNode.getBoundingClientRect().top,r=R(t).y+e-120;window.scrollTo({top:r,left:0,behavior:"smooth"})},B=function(t,e,r){var n=t&&document.getElementById(t);if(n){var o=C()+n.getBoundingClientRect().top-120;window.scrollTo({top:o,left:0,behavior:"smooth"}),i()._iViewer.selectWordingComment(e,r,(function(){var t=T(e);t&&V(t)}))}},Y=function(t,e){var r,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(S!==t||P!==e||n){var o=f.find((function(e){return e.id===t})),a=null==o||null===(r=o.selection)||void 0===r?void 0:r.paragraph_id,c=i();c&&a&&(c.execCommand("tryUnfold",a),c.execCommand("tryUnfoldCollapse",a),c._iViewer.recomputeDrawRanges());var u=T(t);u?c._iViewer.selectWordingComment(t,e,(function(){V(u)})):B(a,t,e)}},q=Object(n.useMemo)((function(){return function(t){var e=L(t);return e.map((function(t){var r=t.id;return{id:r,top:k(e,r)}}))}(_)}),[_]);return Object(n.useEffect)((function(){var t=i();return t.on("creatingComment",I),t.on("cancelCreatingComment",D),t.on("focusComment",F),t.on("unfocusComment",M),window.addEventListener("scroll",U),function(){t.off("creatingComment",I),t.off("cancelCreatingComment",D),t.off("focusComment",F),t.off("unfocusComment",M),window.removeEventListener("scroll",U)}}),[u,S]),Object(n.useEffect)((function(){if(S){var t=function(t,e){var r=T(e);if(!r)return 0;var n=R(r).y,o=L(t);return n-k(o,e)}(_,S);A(t)}}),[S,_]),Object(n.useEffect)((function(){return x.current=Object(h.b)(),x.current.on(h.a.SCROLL,(function(t){var e=t.comment_id,r=t.id;l.find((function(t){return t.commentId===e}))?Y(e,r,!0):s.a.warn(__("内容有更新，选区已丢失"))})),function(){x.current&&x.current.removeAllListeners()}}),[l]),{state:{selectedInfo:g,activeSelectionId:P,creatorVisible:E,translateY:y.translateY,doc:a,me:c,groupPosition:_,wordingComments:u,groupArr:q},dispatch:p,getEngine:i,getScrollTop:C,getOffsetTop:k,getDrawRange:T,getDefaultGroupArr:L,getDefaultPosition:R,createComment:(r=We().mark((function t(e){var r;return We().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v(e);case 2:r=t.sent,G(),r&&i()._iViewer.selectWordingComment(r.id,r.selection.id);case 5:case"end":return t.stop()}}),t)})),o=function(){var t=this,e=arguments;return new Promise((function(n,o){var i=r.apply(t,e);function a(t){$e(i,n,o,a,c,"next",t)}function c(t){$e(i,n,o,a,c,"throw",t)}a(void 0)}))},function(t){return o.apply(this,arguments)}),cancelComment:function(){D()},updateGroupPosition:function(t){j({type:"update",payload:t})},deteleGroupPosition:function(t){j({type:"delete",payload:t})},focusGroup:Y,focusPrevGroup:function(){var t,e,r=q.findIndex((function(t){return t.id===S})),n=null===(t=q[r-1])||void 0===t?void 0:t.id,o=null===(e=u.find((function(t){return t.id===n})))||void 0===e?void 0:e.selection_id;n&&o&&Y(n,o)},focusNextGroup:function(){var t,e,r=q.findIndex((function(t){return t.id===S})),n=null===(t=q[r+1])||void 0===t?void 0:t.id,o=null===(e=u.find((function(t){return t.id===n})))||void 0===e?void 0:e.selection_id;n&&o&&Y(n,o)},transformAllGroup:A,clearAllGroupTransform:N}}var er=function(t){var e=tr(t),r=e.state,n=e.dispatch,i=e.getEngine,a=e.createComment,c=e.cancelComment,u=e.updateGroupPosition,l=e.deteleGroupPosition,f=e.getScrollTop,s=e.getOffsetTop,p=e.getDrawRange,y=e.getDefaultGroupArr,d=e.getDefaultPosition,m=e.focusGroup,h=e.focusPrevGroup,v=e.focusNextGroup,b=e.transformAllGroup,g=e.clearAllGroupTransform,w=i(),O=f()+w._iViewer.domRootNode.getBoundingClientRect().top-60;return o.a.createElement("div",{className:He,style:{marginTop:"".concat(O,"px"),transform:"translateY(".concat(r.translateY,"px)")}},r.wordingComments.map((function(t){return o.a.createElement(Te,{key:t.id,doc:r.doc,me:r.me,comment:t,engine:w,activeSelectionId:r.activeSelectionId,groupArr:r.groupArr,dispatch:n,getDrawRange:p,getDefaultPosition:d,updateGroupPosition:u,deteleGroupPosition:l,focusGroup:m,focusPrevGroup:h,focusNextGroup:v})})),r.creatorVisible&&o.a.createElement(D,{doc:r.doc,selectedInfo:r.selectedInfo,groupPosition:r.groupPosition,createComment:a,cancelComment:c,getDefaultGroupArr:y,getDefaultPosition:d,getOffsetTop:s,updateGroupPosition:u,transformAllGroup:b,clearAllGroupTransform:g}))};er.propTypes={doc:y.a.object,me:y.a.object,dispatch:y.a.func,getEngine:y.a.func,wordingComments:y.a.array,flattenFloorComments:y.a.array,sideCommentState:y.a.object,dispatchSideComment:y.a.func};var rr=er;function nr(t){return nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nr(t)}function or(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return ir(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ir(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ir(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ar(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function cr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ar(Object(r),!0).forEach((function(e){ur(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ar(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ur(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==nr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==nr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===nr(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function lr(t,e){var r=e.type,n=e.payload,o=void 0===n?{}:n,i=o.commentId,a=o.selectionId,c=o.translateY;switch(r){case"hideCreator":return cr(cr({},t),{},{commentsVisible:!0,creatorVisible:!1});case"showCreator":return cr(cr({},t),{},{commentsVisible:!0,creatorVisible:!0,activeSelectionId:a,activeCommentId:i});case"focusComment":return cr(cr({},t),{},{creatorVisible:0===a,commentsVisible:!0,activeSelectionId:a,activeCommentId:i});case"unfocusComment":return cr(cr({},{commentsVisible:null,creatorVisible:!1,activeSelectionId:0,activeCommentId:0,translateY:0}),{},{commentsVisible:t.commentsVisible,translateY:t.translateY});case"transform":return cr(cr({},t),{},{translateY:c});case"resetTransform":return cr(cr({},t),{},{translateY:0});case"hideComments":return cr(cr({},{commentsVisible:null,creatorVisible:!1,activeSelectionId:0,activeCommentId:0,translateY:0}),{},{commentsVisible:!1});case"showComments":return cr(cr({},t),{},{commentsVisible:!0})}}var fr=function(){var t=or(Object(n.useReducer)(lr,{commentsVisible:null,creatorVisible:!1,activeSelectionId:0,activeCommentId:0,translateY:0}),2);return{sideCommentState:t[0],dispatch:t[1]}};function sr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return pr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pr(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var yr=function(t){var e=t.doc,r=t.me,o=t.getEngine,i=t.litecomment,a=t.getContainer,c=t.dispatch,u=t.sidePanelManager,l=sr(Object(n.useState)(!1),2),f=l[0],s=l[1],p=sr(Object(n.useState)([]),2),y=p[0],d=p[1],m=sr(Object(n.useState)([]),2),h=m[0],v=m[1],b=sr(Object(n.useState)(0),2),g=b[0],w=b[1],O=sr(Object(n.useState)(!1),2),_=O[0],E=O[1],S=fr(),P=S.sideCommentState,x=S.dispatch,C=e&&"lake"===e.format,L=!!new URL(document.location).searchParams.get("translate"),k=P.commentsVisible,T=Object(n.useMemo)((function(){return i.comments.filter((function(t){var e=t.type,r=t.selection;return e===j.a.TYPE.WORDING_COMMENT&&null===r.closed_at}))}),[i.comments]),R=Object(n.useMemo)((function(){return T.reduce((function(t,e){var r;return t.push(e),null===(r=e.sub_comments)||void 0===r||r.forEach((function(e){t.push(e)})),t}),[])}),[T]);return Object(n.useEffect)((function(){s(!0)}),[e.id]),Object(n.useEffect)((function(){var t=o(),e=function(e){e.renderList;var r=t._iViewer.getAllDrawRanges().map((function(t){return t.commentId}));d(T.filter((function(t){return r.indexOf(t.id)>=0})))};return t.on("tileRendered",e),function(){t.off("tileRendered",e)}}),[T]),Object(n.useEffect)((function(){var t=o(),e=T.map((function(t){var e=t.id,r=t.selection,n=t.sub_comments,o=void 0===n?[]:n,i=t.deleted_at;return{selection:r,commentId:e,commentsCount:o.filter((function(t){return null===t.deleted_at})).length+(null===i?1:0)}}));if(t&&e){var r=t._iViewer.getWordingList(e);w(r.map((function(t){return t.commentsCount})).reduce((function(t,e){return t+e}),0)),v(r),f?(t._iViewer.tileRenderWording(r),s(!1)):t._iViewer.tileRenderWording(r,{clearCache:!1})}}),[T]),Object(n.useEffect)((function(){var t;k||o()._iViewer.clearHighlightWording();_||null===k||(t=new CustomEvent("contentSidebarVisibleChange",{detail:{visible:k,type:"wordingComment"}}),window.dispatchEvent(t)),E(!1),u&&k&&u.show("WordingComment")}),[k]),{state:{panelVisible:k,sideCommentState:P,isTranslating:L,isLake:C,doc:e,me:r,wordingComments:y,wordingList:h,wordingSelectionsCount:g,flattenFloorComments:R},dispatch:c,getEngine:o,getContainer:a,dispatchSideComment:x,onClose:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];u&&u.hide("WordingComment"),E(t),x({type:"hideComments"})}}},dr="index-module_commentPanel_rHJ+M",mr="index-module_toolbar_WR5Oc",hr="index-module_toolbarContent_wiz0k",vr="index-module_text_Mbvbt",br="index-module_closeBtn_wG-wO",gr="index-module_closeIcon_BZ+U-",wr="index-module_visible_Rew5O",Or="index-module_hidden_QeAYC",_r=Object(n.forwardRef)((function(t,e){var r=yr(t),i=r.state,c=r.getContainer,u=r.getEngine,s=r.dispatch,p=r.dispatchSideComment,y=r.onClose,d=c(),m="";m=null===i.panelVisible?"":i.panelVisible?wr:Or;var h=l()(dr,m);function v(t){var e=t.onLayout;return Object(n.useEffect)((function(){return p({type:"showComments"}),e({width:305}),function(){p({type:"hideComments"})}}),[]),o.a.createElement(o.a.Fragment,null)}return Object(n.useImperativeHandle)(e,(function(){return{onClose:y}})),Object(n.useEffect)((function(){t.sidePanelManager&&d&&(window.sidePanelManager=t.sidePanelManager,t.sidePanelManager.registerContent("WordingComment",v))}),[d]),i.isLake&&!i.isTranslating&&d?a.a.createPortal(o.a.createElement("div",{className:h},o.a.createElement("div",{className:mr},o.a.createElement("div",{className:hr},o.a.createElement("div",{className:vr},__("划词评论（{count}）",{count:i.wordingSelectionsCount})),o.a.createElement("div",{className:br,onClick:function(){y(!1)}},o.a.createElement(f.b,{name:"close",className:gr})))),o.a.createElement(rr,{doc:i.doc,me:i.me,getEngine:u,wordingComments:i.wordingComments,wordingList:i.wordingList,flattenFloorComments:i.flattenFloorComments,sideCommentState:i.sideCommentState,dispatch:s,dispatchSideComment:p})),d):null}));e.default=Object(c.d)((function(t){return{me:t.me,doc:t.doc,book:t.book,litecomment:t.litecomment}}),null,null,{forwardRef:!0})(_r)}}]);